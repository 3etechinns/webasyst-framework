jQuery.fn.waDialog=function(a){var a=jQuery.extend({loading_header:"",title:"",esc:!0,buttons:null,url:null,url_reload:!0,"class":null,content:null,width:0,height:0,"min-width":0,"min-height":0,disableButtonsOnSubmit:!1,onLoad:null,onCancel:null,onSubmit:null},a||{}),b=$(this),c=b.attr("id");c&&!b.hasClass("dialog")&&(b.removeAttr("id"),$("#"+c).length&&(a.url?(b=$("#"+c),a.url_reload||(a.url=null)):$("#"+c).remove()));var d=a["class"]||a.className?a["class"]||a.className:b.attr("class")||"";if(b.hasClass("dialog"))a.content&&
(b.find(".dialog-content-indent").html(a.content),a.title&&b.find(".dialog-content-indent").prepend("<h1>"+a.title+"</h1>")),a.buttons&&b.find(".dialog-buttons-gradient").empty().append(a.buttons);else{var e=$(this),b=$("<div "+(c?'id = "'+c+'"':"")+' class="dialog '+d+'" style="display: none"><div class="dialog-background"></div><div class="dialog-window"></div></div>').appendTo("body");if(e.find(".dialog-content").length||e.find(".dialog-buttons").length){if($(".dialog-window",b).append(e.show()),
c=e.find(".dialog-content"),c.length&&(d=$('<div class="dialog-content-indent"></div>'),c.contents().appendTo(d),c.append(d)),c=e.find(".dialog-buttons"),c.length)d=$('<div class="dialog-buttons-gradient"></div>'),c.contents().appendTo(d),c.append(d)}else $(".dialog-window",b).append((a.onSubmit?'<form method="post" action="">':"")+'<div class="dialog-content"><div class="dialog-content-indent"></div></div><div class="dialog-buttons"><div class="dialog-buttons-gradient"></div></div>'+(a.onSubmit?
"</form>":"")),b.find(".dialog-content-indent").append(e.show());a.buttons&&b.find(".dialog-buttons-gradient").empty().append(a.buttons);a.url?b.find(".dialog-content-indent").append("<h1>"+(a.loading_header||"")+'<i class="icon16 loading"></i></h1>'):a.content&&b.find(".dialog-content-indent").append(a.content);a.title&&b.find(".dialog-content-indent").prepend("<h1>"+a.title+"</h1>")}b.find(".dialog-background").length||b.prepend('<div class="dialog-background"> </div>');b.bind("close",function(){a.onClose&&
a.onClose.call($(this));$(this).hide()});e=["width","height","min-width","min-height"];for(c=0;c<e.length;c++)a[e[c]]&&(("height"==e[c]&&"300px">a[e[c]]||"width"==e[c]&&"400px">a[e[c]])&&b.find("div.dialog-window").css("min-"+e[c],a[e[c]]),b.find("div.dialog-window").css(e[c],a[e[c]]));a.disableButtonsOnSubmit&&b.find("input[type=submit]").removeAttr("disabled");b.parent().length||b.appendTo("body");b.show();a.url?jQuery.get(a.url,function(f){var c=$(f);if(c.find(".dialog-content").length||c.find(".dialog-buttons").length){c.find(".dialog-content").length&&
b.find(".dialog-content-indent").empty().append(c.find(".dialog-content").contents());c.find(".dialog-buttons").length&&b.find(".dialog-buttons-gradient").empty().append(c.find(".dialog-buttons").contents())}else b.find(".dialog-content-indent").html(f);b.trigger("wa-resize");a.onLoad&&a.onLoad.call(b.get(0))}):a.onLoad&&a.onLoad.call(b.get(0));b.find(".dialog-buttons").delegate(".cancel","click",function(c){c.stopPropagation();c.preventDefault();a.onCancel&&a.onCancel.call(b.get(0));b.trigger("close");
return false});a.onSubmit&&b.find("form").unbind("submit").submit(function(){a.disableButtonsOnSubmit&&b.find("input[type=submit]").attr("disabled","disabled");return a.onSubmit.apply(this,[b])});b.bind("wa-resize",function(){var a=jQuery(this).find(".dialog-window"),b=a.width(),c=a.height();jQuery("body").css("min-height",c+"px");var e=jQuery(window).width(),d=jQuery(window).height()-60,b=(e-b)/2/e,c=(d-c-60)/2/d;c<0&&(c=0);b<0&&(b=0);a.css({left:Math.round(b*100)+"%",top:Math.round(c*100)+"%"})}).trigger("wa-resize");
a.esc&&b.bind("esc",function(){b.trigger("close")});return b};jQuery(window).resize(function(){jQuery(".dialog:visible").trigger("wa-resize")});jQuery(document).keyup(function(a){27==a.keyCode&&jQuery(".dialog:visible").trigger("esc")});/*
 GNU Affero General Public License - {@link http://www.gnu.org/licenses/agpl.html}
 @example Visit {@link http://jquery.com/plugins/project/jquery_history_bal} for more information.


 I would like to take this space to thank the following projects, blogs, articles and people:
 - jQuery {@link http://jquery.com/}
 - jQuery UI History - Klaus Hartl {@link http://www.stilbuero.de/jquery/ui_history/}
 - Really Simple History - Brian Dillard and Brad Neuberg {@link http://code.google.com/p/reallysimplehistory/}
 - jQuery History Plugin - Taku Sano (Mikage Sawatari) {@link http://www.mikage.to/jquery/jquery_history.html}
 - jQuery History Remote Plugin - Klaus Hartl {@link http://stilbuero.de/jquery/history/}
 - Content With Style: Fixing the back button and enabling bookmarking for ajax apps - Mike Stenhouse {@link http://www.contentwithstyle.co.uk/Articles/38/fixing-the-back-button-and-enabling-bookmarking-for-ajax-apps}
 - Bookmarks and Back Buttons {@link http://ajax.howtosetup.info/options-and-efficiencies/bookmarks-and-back-buttons/}
 - Ajax: How to handle bookmarks and back buttons - Brad Neuberg {@link http://dev.aol.com/ajax-handling-bookmarks-and-back-button}



 CHANGELOG

 v1.0.1-final, July 11, 2009
 - Restructured a little bit
 - Documented
 - Cleaned go/request

 v1.0.0-final, June 19, 2009
 - Been stable for over a year now, pushing live.

 v0.1.0-dev, July 24, 2008
 - Initial Release

*/
(function(a){"undefined"===typeof console&&(console="undefined"!==typeof window.console?window.console:{});console.log=console.log||function(){};console.debug=console.debug||console.log;console.warn=console.warn||console.log;console.error=console.error||function(){for(var a=[],c=0;c<arguments.length;c++)a.push(arguments[c]);alert(a.join("\n"))};console.trace=console.trace||console.log;console.group=console.group||console.log;console.groupEnd=console.groupEnd||console.log;console.profile=console.profile||
console.log;console.profileEnd=console.profileEnd||console.log;a.History={options:{debug:!1},state:"",$window:null,$iframe:null,handlers:{generic:[],specific:{}},format:function(a){return a=a.replace(/^.+?#/g,"").replace(/^#?\/?|\/?$/g,"")},getState:function(){return a.History.state},setState:function(b){var c=a.History,b=c.format(b);c.state=b;return c.state},getHash:function(){var b=parent&&!a.browser.msie?parent.window.location.hash:window.location.hash||location.hash;return b=a.History.format(b)},
setHash:function(b){b=a.History.format(b);b=b.replace(/^\/?|\/?(\?)|\/?$/g,"/$1");"undefined"===typeof window.location.hash&&(location.hash=b);a.browser.msie&&8>parseInt(a.browser.version,10)&&(a.History.$iframe.contentWindow.document.open(),a.History.$iframe.contentWindow.document.close())},go:function(b){var c=a.History,b=c.format(b);c.getHash()!==b?c.setHash(b):(c.setState(b),c.trigger());return!0},hashchange:function(b){var c=a.History;c.options.debug&&console.debug("History.hashchange",this,
arguments);var d=c.getHash(),e=c.getState();if(!c.$iframe&&e===d||c.$iframe&&c.hash===c.$iframe.contentWindow.document.location.hash||e===d)return!1;c.setState(d);c.trigger();return!0},bind:function(b,c){var d=a.History;c?("undefined"===typeof d.handlers.specific[b]&&(d.handlers.specific[b]=[]),d.handlers.specific[b].push(c)):d.handlers.generic.push(b);return!0},trigger:function(b){var c=a.History;"undefined"===typeof b&&(b=c.getState());var d,e,f,g;if("undefined"!==typeof c.handlers.specific[b]){g=
c.handlers.specific[b];d=0;for(e=g.length;d<e;++d)f=g[d],f(b)}g=c.handlers.generic;d=0;for(e=g.length;d<e;++d)f=g[d],f(b);return!0},construct:function(){var b=a.History;a(document).ready(function(){b.domReady()});return!0},configure:function(b){var c=a.History;c.options=a.extend(c.options,b);return!0},domReadied:!1,domReady:function(){var b=a.History;if(!b.domRedied)return b.domRedied=!0,b.$window=a(window),b.$window.bind("hashchange",this.hashchange),setTimeout(b.hashchangeLoader,200),!0},hashchangeLoader:function(){var b=
a.History;if(a.browser.msie&&8<=parseInt(a.browser.version))(c=b.getHash())&&b.$window.trigger("hashchange");else{if(a.browser.msie){b.$iframe=a('<iframe id="jquery-history-iframe" style="display: none;"></$iframe>').prependTo(document.body)[0];b.$iframe.contentWindow.document.open();b.$iframe.contentWindow.document.close();var c=b.getHash();c&&(b.$iframe.contentWindow.document.location.hash=c);c=function(){var a=b.format(b.$iframe.contentWindow.document.location.hash);b.getState()!==a&&b.setHash(b.$iframe.contentWindow.document.location.hash);
a=b.getHash();b.getState()!==a&&b.go(a)}}else c=function(){var a=b.getHash();b.getState()!==a&&b.go(a)};a.browser.msie&&8>parseInt(a.browser.version)?setInterval(c,1500):setInterval(c,200)}return!0}};a.History.construct()})(jQuery);$.wa=$.ui?$.extend(!0,$.wa,$.ui):{};
$.wa=$.extend(!0,$.wa,{data:{},get:function(a,b){return a==void 0?this.data:this.data[name]||b||null},set:function(a){if(a==void 0)return this.data;typeof a=="object"?$.extend(this.data,a):this.data[a]=value;return this.data},encodeHTML:function(a){return a&&(""+a).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},decodeHTML:function(a){return a.replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">")},setHash:function(a){!(a instanceof String)&&a.toString&&(a=a.toString());
a=a.replace(/\/\//g,"/");a=a.replace(/^.*#/,"");parent&&!$.browser.msie?parent.window.location.hash=a:location.hash=a;return true},back:function(a){history.length>2?typeof a=="number"&&parseInt(a)==a?history.go(-a):history.go(-1):$.browser.msie&&history.length>0?history.back():a&&this.setHash(a);return false},toggleHashParam:function(a){location.hash.search(a)==-1?this.addToHash(a):this.removeFromHash(a)},addToHash:function(a){var b=location.hash;b.search(a)==-1&&(b=b+("/"+a+"/"));this.setHash(b)},
removeFromHash:function(a){var b=location.hash;b.search(a)>-1&&(b=b.replace(a,""));this.setHash(b)},setTitle:function(a){document.title=a},array_search:function(a,b,c){var c=!!c,d;for(d in b)if(c&&b[d]===a||!c&&b[d]==a)return d;return false},dialogCreate:function(a,b){b=$.extend({content:'<h1>Loading... <i class="icon16 loading"></i></h1>',buttons:null,url:null,post:null,small:false,onload:null,oncancel:null},b);b.content=$(b.content);b.buttons=b.buttons?$(b.buttons):$('<input type="submit" class="button gray" value="'+
$_("Cancel")+'">').click(function(){b.oncancel&&b.oncancel.call(c[0]);$.wa.dialogHide()});var c=$("#"+a);c.size()<=0&&(c=$('<div class="dialog" id="'+a+'" style="display: none"><div class="dialog-background"></div><div class="dialog-window"><div class="dialog-content"><div class="dialog-content-indent"></div></div><div class="dialog-buttons"><div class="dialog-buttons-gradient"></div></div></div></div>').appendTo("body"));c.find(".dialog-buttons-gradient").empty().append(b.buttons);c.find(".dialog-content-indent").empty().append(b.content);
c.show();b.small?c.addClass("small"):c.removeClass("small");if(b.url){var d=function(a){c.find(".dialog-content-indent").html(a);$.wa.waCenterDialog(c);b.onload&&b.onload.call(c[0])};b.post?$.post(b.url,b.post,d):$.get(b.url,d)}this.waCenterDialog(c);var e=function(a){if(c.is(":visible"))if(a&&a.keyCode==27){b.oncancel&&typeof b.oncancel=="function"&&b.oncancel.call(c[0]);$.wa.dialogHide()}else $(document).one("keyup",e)};e();$(document).one("hashchange",$.wa.dialogHide);return c},waCenterDialog:function(a){var a=
$(a),a=a.find(".dialog-window"),b=a.outerWidth(true),c=a.outerHeight(true),d=$(window).width(),e=$(window).height(),c=(e-c)/2/e;a.css({left:Math.round((d-b)/2/d*100)+"%",top:Math.round(c*100)+"%"})},dialogHide:function(){$(".dialog").hide();return false},dropdownsClose:function(){var a=$(".dropdown:not(.disabled)");a.addClass("disabled");setTimeout(function(){a.removeClass("disabled")},600)},dropdownsCloseEnable:function(){$(".dropdown:not(.disabled)").live("click",this.dropdownsClickHandler)},dropdownsCloseDisable:function(){$(".dropdown:not(.disabled)").die("click",
this.dropdownsClickHandler)},dropdownsClickHandler:function(){var a=$(this);if(!a.hasClass("no-click-close")){a.addClass("disabled");setTimeout(function(){a.removeClass("disabled")},600)}},defaultInputValue:function(a,b,c){a instanceof jQuery||(a=$(a));var d=function(){var e=a.val();if(!e||e==b){a.val(b);a.addClass(c)}};d();a.blur(d);a.focus(function(){if(a.hasClass(c)){a.removeClass(c);a.val("")}})},util:{formatFileSize:function(a){var b=-1;do{a=a/1024;b++}while(a>99);return Math.max(a,0.01).toFixed(2)+
(b>=0?" "+$_(["kB","MB","GB","TB","PB","EB"][b]):"")}}});
$(document).ajaxError(function(a,b){if(200!==b.status&&b.responseText){if(!$.wa.errorHandler||$.wa.errorHandler(b))-1!=b.responseText.indexOf("Exception")?$.wa.dialogCreate("ajax-error",{content:"<div>"+b.responseText+"</div>"}):(document.open("text/html"),document.write(b.responseText),document.close(),$(window).one("hashchange",function(){window.location.reload()}))}else b.getResponseHeader("wa-session-expired")?window.location.reload():"undefined"!==typeof b.responseText&&-1!=b.responseText.indexOf("Exception")&&
$.wa.dialogCreate("ajax-error",{content:"<div>"+b.responseText+"</div>"})});$.ajaxSetup({cache:!1});$(document).ajaxSend(function(a,b,c){"POST"==c.type&&((a=(a=document.cookie.match(/(?:^|; )_csrf=([^;]*)/))?decodeURIComponent(a[1]):"",null===c.data&&(c.data=""),"string"==typeof c.data)?-1==c.data.indexOf("_csrf=")&&(c.data+=(0<c.data.length?"&":"")+"_csrf="+a):"object"==typeof c.data&&(c.data._csrf=a))});
Array.prototype.indexOf||(Array.prototype.indexOf=function(a,b){var c=this.length,d=Number(b)||0,d=0>d?Math.ceil(d):Math.floor(d);for(0>d&&(d+=c);d<c;d++)if(d in this&&this[d]===a)return d;return-1});$.wa.locale=$.wa.locale||{};
$_=function(a,b){if(b){if(!$.wa.locale[b]){console&&console.log("Localization failed: "+b);return b}if(typeof $.wa.locale[b]=="string")return $.wa.locale[b];var c=a%10;return Math.floor(a/10)%10==1||c>4||c==0?$.wa.locale[b][2]:c==1?$.wa.locale[b][0]:$.wa.locale[b][1]}if($.wa.locale[a])return typeof $.wa.locale[a]=="string"?$.wa.locale[a]:$.wa.locale[a][0];console&&console.log("Localization failed: "+a);return a};jQuery.JSON={useHasOwn:{}.hasOwnProperty?!0:!1,pad:function(a){return 10>a?"0"+a:a},m:{"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},encodeString:function(a){return/["\\\x00-\x1f]/.test(a)?'"'+a.replace(/([\x00-\x1f\\"])/g,function(a,c){var d=jQuery.JSON.m[c];if(d)return d;d=c.charCodeAt();return"\\u00"+Math.floor(d/16).toString(16)+(d%16).toString(16)})+'"':'"'+a+'"'},encodeArray:function(a){var b=["["],c,d,e=a.length,f;for(d=0;d<e;d+=1)switch(f=a[d],typeof f){case "undefined":case "function":case "unknown":break;
default:c&&b.push(","),b.push(null===f?"null":this.encode(f)),c=!0}b.push("]");return b.join("")},encodeDate:function(a){return'"'+a.getFullYear()+"-"+pad(a.getMonth()+1)+"-"+pad(a.getDate())+"T"+pad(a.getHours())+":"+pad(a.getMinutes())+":"+pad(a.getSeconds())+'"'},encode:function(a){if("undefined"==typeof a||null===a)return"null";if(a instanceof Array)return this.encodeArray(a);if(a instanceof Date)return this.encodeDate(a);if("string"==typeof a)return this.encodeString(a);if("number"==typeof a)return isFinite(a)?
String(a):"null";if("boolean"==typeof a)return String(a);var b=["{"],c,d,e;for(d in a)if(!this.useHasOwn||a.hasOwnProperty(d))switch(e=a[d],typeof e){case "undefined":case "function":case "unknown":break;default:c&&b.push(","),b.push(this.encode(d),":",null===e?"null":this.encode(e)),c=!0}b.push("}");return b.join("")},decode:function(a){return eval("("+a+")")}};(function(a,b){a.store=function(b,d){var e=this;if("string"==typeof b)if(a.store.drivers[b])this.driver=a.store.drivers[b];else throw Error("Unknown driver "+b);else if("object"==typeof b){if(!a.isFunction(b.init)||!a.isFunction(b.get)||!a.isFunction(b.set)||!a.isFunction(b.del)||!a.isFunction(b.flush))throw Error("The specified driver does not fulfill the API requirements");this.driver=b}else a.each(a.store.drivers,function(){if(!a.isFunction(this.available)||!this.available())return!0;e.driver=
this;return!1===e.driver.init()?(e.driver=null,!0):!1});d||(d=a.store.serializers);this.serializers={};a.each(d,function(b){if(!a.isFunction(this.init))return true;e.serializers[b]=this;e.serializers[b].init(e.encoders,e.decoders)})};a.extend(a.store.prototype,{get:function(a){a=this.driver.get(a);return this.driver.encodes?a:this.unserialize(a)},set:function(a,b){this.driver.set(a,this.driver.encodes?b:this.serialize(b))},del:function(a){this.driver.del(a)},flush:function(){this.driver.flush()},
driver:b,encoders:[],decoders:[],serialize:function(b){var d=this;a.each(this.encoders,function(){var a=d.serializers[this+""];if(!a||!a.encode)return!0;try{b=a.encode(b)}catch(f){}});return b},unserialize:function(b){var d=this;if(!b)return b;a.each(this.decoders,function(){var a=d.serializers[this+""];if(!a||!a.decode)return!0;b=a.decode(b)});return b}});a.store.drivers={localStorage:{ident:"$.store.drivers.localStorage",scope:"browser",available:function(){try{return!!window.localStorage}catch(a){return!1}},
init:a.noop,get:function(a){return window.localStorage.getItem(a)},set:function(a,b){window.localStorage.setItem(a,b)},del:function(a){window.localStorage.removeItem(a)},flush:function(){window.localStorage.clear()}},userData:{ident:"$.store.drivers.userData",element:null,nodeName:"userdatadriver",scope:"browser",initialized:!1,available:function(){try{return!(!document.documentElement||!document.documentElement.addBehavior)}catch(a){return!1}},init:function(){if(!this.initialized)try{this.element=
document.createElement(this.nodeName),document.documentElement.insertBefore(this.element,document.getElementsByTagName("title")[0]),this.element.addBehavior("#default#userData"),this.initialized=!0}catch(a){return!1}},get:function(a){this.element.load(this.nodeName);return this.element.getAttribute(a)},set:function(a,b){this.element.setAttribute(a,b);this.element.save(this.nodeName)},del:function(a){this.element.removeAttribute(a);this.element.save(this.nodeName)},flush:function(){this.element.expires=
(new Date).toUTCString();this.element.save(this.nodeName)}},windowName:{ident:"$.store.drivers.windowName",scope:"window",cache:{},encodes:!0,available:function(){return!0},init:function(){this.load()},save:function(){window.name=a.store.serializers.json.encode(this.cache)},load:function(){try{this.cache=a.store.serializers.json.decode(window.name+""),"object"!=typeof this.cache&&(this.cache={})}catch(b){this.cache={},window.name="{}"}},get:function(a){return this.cache[a]},set:function(a,b){this.cache[a]=
b;this.save()},del:function(a){try{delete this.cache[a]}catch(d){this.cache[a]=b}this.save()},flush:function(){window.name="{}"}}};a.store.serializers={json:{ident:"$.store.serializers.json",init:function(a,b){a.push("json");b.push("json")},encode:"object"==typeof JSON?JSON.stringify:a.JSON.stringify,decode:"object"==typeof JSON?JSON.parse:a.JSON.parse},xml:{ident:"$.store.serializers.xml",init:function(a,b){a.unshift("xml");b.push("xml")},isXML:function(a){return(a=(a?a.ownerDocument||a:0).documentElement)?
"html"!==a.nodeName.toLowerCase():!1},encode:function(a){if(!a||a._serialized||!this.isXML(a))return a;var b={_serialized:this.ident,value:a};try{return b.value=(new XMLSerializer).serializeToString(a),b}catch(e){try{return b.value=a.xml,b}catch(f){}}return a},decode:function(a){if(!a||!a._serialized||a._serialized!=this.ident)return a;var d="DOMParser"in window&&(new DOMParser).parseFromString;!d&&window.ActiveXObject&&(d=function(a){var b=new ActiveXObject("Microsoft.XMLDOM");b.async="false";b.loadXML(a);
return b});if(!d)return b;a.value=d.call("DOMParser"in window&&new DOMParser||window,a.value,"text/xml");return this.isXML(a.value)?a.value:b}}}})(jQuery);(function(a){a.ui=a.ui||{};var b=/left|center|right/,c=/top|center|bottom/,d=a.fn.position,e=a.fn.offset;a.fn.position=function(f){if(!f||!f.of)return d.apply(this,arguments);var f=a.extend({},f),e=a(f.of),h=e[0],k=(f.collision||"flip").split(" "),l=f.offset?f.offset.split(" "):[0,0],j,o,m;9===h.nodeType?(j=e.width(),o=e.height(),m={top:0,left:0}):h.setTimeout?(j=e.width(),o=e.height(),m={top:e.scrollTop(),left:e.scrollLeft()}):h.preventDefault?(f.at="left top",j=o=0,m={top:f.of.pageY,left:f.of.pageX}):
(j=e.outerWidth(),o=e.outerHeight(),m=e.offset());a.each(["my","at"],function(){var a=(f[this]||"").split(" ");a.length===1&&(a=b.test(a[0])?a.concat(["center"]):c.test(a[0])?["center"].concat(a):["center","center"]);a[0]=b.test(a[0])?a[0]:"center";a[1]=c.test(a[1])?a[1]:"center";f[this]=a});1===k.length&&(k[1]=k[0]);l[0]=parseInt(l[0],10)||0;1===l.length&&(l[1]=l[0]);l[1]=parseInt(l[1],10)||0;"right"===f.at[0]?m.left+=j:"center"===f.at[0]&&(m.left+=j/2);"bottom"===f.at[1]?m.top+=o:"center"===f.at[1]&&
(m.top+=o/2);m.left+=l[0];m.top+=l[1];return this.each(function(){var b=a(this),e=b.outerWidth(),c=b.outerHeight(),d=parseInt(a.curCSS(this,"marginLeft",true))||0,g=parseInt(a.curCSS(this,"marginTop",true))||0,h=e+d+(parseInt(a.curCSS(this,"marginRight",true))||0),r=c+g+(parseInt(a.curCSS(this,"marginBottom",true))||0),n=a.extend({},m),q;if(f.my[0]==="right")n.left=n.left-e;else if(f.my[0]==="center")n.left=n.left-e/2;if(f.my[1]==="bottom")n.top=n.top-c;else if(f.my[1]==="center")n.top=n.top-c/2;
n.left=Math.round(n.left);n.top=Math.round(n.top);q={left:n.left-d,top:n.top-g};a.each(["left","top"],function(b,d){a.ui.position[k[b]]&&a.ui.position[k[b]][d](n,{targetWidth:j,targetHeight:o,elemWidth:e,elemHeight:c,collisionPosition:q,collisionWidth:h,collisionHeight:r,offset:l,my:f.my,at:f.at})});a.fn.bgiframe&&b.bgiframe();b.offset(a.extend(n,{using:f.using}))})};a.ui.position={fit:{left:function(b,e){var c=a(window),c=e.collisionPosition.left+e.collisionWidth-c.width()-c.scrollLeft();b.left=
0<c?b.left-c:Math.max(b.left-e.collisionPosition.left,b.left)},top:function(b,e){var c=a(window),c=e.collisionPosition.top+e.collisionHeight-c.height()-c.scrollTop();b.top=0<c?b.top-c:Math.max(b.top-e.collisionPosition.top,b.top)}},flip:{left:function(b,e){if("center"!==e.at[0]){var c=a(window),c=e.collisionPosition.left+e.collisionWidth-c.width()-c.scrollLeft(),d="left"===e.my[0]?-e.elemWidth:"right"===e.my[0]?e.elemWidth:0,l="left"===e.at[0]?e.targetWidth:-e.targetWidth,j=-2*e.offset[0];b.left+=
0>e.collisionPosition.left?d+l+j:0<c?d+l+j:0}},top:function(b,e){if("center"!==e.at[1]){var c=a(window),c=e.collisionPosition.top+e.collisionHeight-c.height()-c.scrollTop(),d="top"===e.my[1]?-e.elemHeight:"bottom"===e.my[1]?e.elemHeight:0,l="top"===e.at[1]?e.targetHeight:-e.targetHeight,j=-2*e.offset[1];b.top+=0>e.collisionPosition.top?d+l+j:0<c?d+l+j:0}}}};a.offset.setOffset||(a.offset.setOffset=function(b,e){/static/.test(a.curCSS(b,"position"))&&(b.style.position="relative");var c=a(b),d=c.offset(),
l=parseInt(a.curCSS(b,"top",!0),10)||0,j=parseInt(a.curCSS(b,"left",!0),10)||0,d={top:e.top-d.top+l,left:e.left-d.left+j};"using"in e?e.using.call(b,d):c.css(d)},a.fn.offset=function(b){var c=this[0];return!c||!c.ownerDocument?null:b?this.each(function(){a.offset.setOffset(this,b)}):e.call(this)})})(jQuery);(function(a,b){var c={buttons:!0,height:!0,maxHeight:!0,maxWidth:!0,minHeight:!0,minWidth:!0,width:!0},d={maxHeight:!0,maxWidth:!0,minHeight:!0,minWidth:!0};a.widget("ui.dialog",{options:{autoOpen:!0,buttons:{},closeOnEscape:!0,closeText:"close",dialogClass:"",draggable:!0,hide:null,height:"auto",maxHeight:!1,maxWidth:!1,minHeight:150,minWidth:150,modal:!1,position:{my:"center",at:"center",collision:"fit",using:function(b){var c=a(this).css(b).offset().top;0>c&&a(this).css("top",b.top-c)}},resizable:!0,
show:null,stack:!0,title:"",width:300,zIndex:1E3},_create:function(){this.originalTitle=this.element.attr("title");"string"!==typeof this.originalTitle&&(this.originalTitle="");this.options.title=this.options.title||this.originalTitle;var b=this,c=b.options,d=c.title||"&#160;",h=a.ui.dialog.getTitleId(b.element),k=(b.uiDialog=a("<div></div>")).appendTo(document.body).hide().addClass("ui-dialog ui-widget ui-widget-content ui-corner-all "+c.dialogClass).css({zIndex:c.zIndex}).attr("tabIndex",-1).css("outline",
0).keydown(function(d){if(c.closeOnEscape&&d.keyCode&&d.keyCode===a.ui.keyCode.ESCAPE){b.close(d);d.preventDefault()}}).attr({role:"dialog","aria-labelledby":h}).mousedown(function(a){b.moveToTop(false,a)});b.element.show().removeAttr("title").addClass("ui-dialog-content ui-widget-content").appendTo(k);var l=(b.uiDialogTitlebar=a("<div></div>")).addClass("ui-dialog-titlebar ui-widget-header ui-corner-all ui-helper-clearfix").prependTo(k),j=a('<a href="#"></a>').addClass("ui-dialog-titlebar-close ui-corner-all").attr("role",
"button").hover(function(){j.addClass("ui-state-hover")},function(){j.removeClass("ui-state-hover")}).focus(function(){j.addClass("ui-state-focus")}).blur(function(){j.removeClass("ui-state-focus")}).click(function(a){b.close(a);return false}).appendTo(l);(b.uiDialogTitlebarCloseText=a("<span></span>")).addClass("ui-icon ui-icon-closethick").text(c.closeText).appendTo(j);a("<span></span>").addClass("ui-dialog-title").attr("id",h).html(d).prependTo(l);a.isFunction(c.beforeclose)&&!a.isFunction(c.beforeClose)&&
(c.beforeClose=c.beforeclose);l.find("*").add(l).disableSelection();c.draggable&&a.fn.draggable&&b._makeDraggable();c.resizable&&a.fn.resizable&&b._makeResizable();b._createButtons(c.buttons);b._isOpen=!1;a.fn.bgiframe&&k.bgiframe()},_init:function(){this.options.autoOpen&&this.open()},destroy:function(){this.overlay&&this.overlay.destroy();this.uiDialog.hide();this.element.unbind(".dialog").removeData("dialog").removeClass("ui-dialog-content ui-widget-content").hide().appendTo("body");this.uiDialog.remove();
this.originalTitle&&this.element.attr("title",this.originalTitle);return this},widget:function(){return this.uiDialog},close:function(b){var c=this,d,h;if(!1!==c._trigger("beforeClose",b))return c.overlay&&c.overlay.destroy(),c.uiDialog.unbind("keypress.ui-dialog"),c._isOpen=!1,c.options.hide?c.uiDialog.hide(c.options.hide,function(){c._trigger("close",b)}):(c.uiDialog.hide(),c._trigger("close",b)),a.ui.dialog.overlay.resize(),c.options.modal&&(d=0,a(".ui-dialog").each(function(){if(this!==c.uiDialog[0]){h=
a(this).css("z-index");isNaN(h)||(d=Math.max(d,h))}}),a.ui.dialog.maxZ=d),c},isOpen:function(){return this._isOpen},moveToTop:function(b,c){var d=this.options;if(d.modal&&!b||!d.stack&&!d.modal)return this._trigger("focus",c);d.zIndex>a.ui.dialog.maxZ&&(a.ui.dialog.maxZ=d.zIndex);this.overlay&&(a.ui.dialog.maxZ+=1,this.overlay.$el.css("z-index",a.ui.dialog.overlay.maxZ=a.ui.dialog.maxZ));b={scrollTop:this.element.attr("scrollTop"),scrollLeft:this.element.attr("scrollLeft")};a.ui.dialog.maxZ+=1;this.uiDialog.css("z-index",
a.ui.dialog.maxZ);this.element.attr(b);this._trigger("focus",c);return this},open:function(){if(!this._isOpen){var b=this.options,c=this.uiDialog;this.overlay=b.modal?new a.ui.dialog.overlay(this):null;this._size();this._position(b.position);c.show(b.show);this.moveToTop(!0);b.modal&&c.bind("keypress.ui-dialog",function(b){if(b.keyCode===a.ui.keyCode.TAB){var c=a(":tabbable",this),e=c.filter(":first"),c=c.filter(":last");if(b.target===c[0]&&!b.shiftKey)return e.focus(1),!1;if(b.target===e[0]&&b.shiftKey)return c.focus(1),
!1}});a(this.element.find(":tabbable").get().concat(c.find(".ui-dialog-buttonpane :tabbable").get().concat(c.get()))).eq(0).focus();this._isOpen=!0;this._trigger("open");return this}},_createButtons:function(b){var c=this,d=!1,h=a("<div></div>").addClass("ui-dialog-buttonpane ui-widget-content ui-helper-clearfix"),k=a("<div></div>").addClass("ui-dialog-buttonset").appendTo(h);c.uiDialog.find(".ui-dialog-buttonpane").remove();"object"===typeof b&&null!==b&&a.each(b,function(){return!(d=!0)});d&&(a.each(b,
function(b,e){e=a.isFunction(e)?{click:e,text:b}:e;b=a('<button type="button"></button>').attr(e,!0).unbind("click").click(function(){e.click.apply(c.element[0],arguments)}).appendTo(k);a.fn.button&&b.button()}),h.appendTo(c.uiDialog))},_makeDraggable:function(){function b(a){return{position:a.position,offset:a.offset}}var c=this,d=c.options,h=a(document),k;c.uiDialog.draggable({cancel:".ui-dialog-content, .ui-dialog-titlebar-close",handle:".ui-dialog-titlebar",containment:"document",start:function(h,
j){k="auto"===d.height?"auto":a(this).height();a(this).height(a(this).height()).addClass("ui-dialog-dragging");c._trigger("dragStart",h,b(j))},drag:function(a,d){c._trigger("drag",a,b(d))},stop:function(l,j){d.position=[j.position.left-h.scrollLeft(),j.position.top-h.scrollTop()];a(this).removeClass("ui-dialog-dragging").height(k);c._trigger("dragStop",l,b(j));a.ui.dialog.overlay.resize()}})},_makeResizable:function(c){function d(a){return{originalPosition:a.originalPosition,originalSize:a.originalSize,
position:a.position,size:a.size}}var c=c===b?this.options.resizable:c,g=this,h=g.options,k=g.uiDialog.css("position"),c="string"===typeof c?c:"n,e,s,w,se,sw,ne,nw";g.uiDialog.resizable({cancel:".ui-dialog-content",containment:"document",alsoResize:g.element,maxWidth:h.maxWidth,maxHeight:h.maxHeight,minWidth:h.minWidth,minHeight:g._minHeight(),handles:c,start:function(b,c){a(this).addClass("ui-dialog-resizing");g._trigger("resizeStart",b,d(c))},resize:function(a,b){g._trigger("resize",a,d(b))},stop:function(b,
c){a(this).removeClass("ui-dialog-resizing");h.height=a(this).height();h.width=a(this).width();g._trigger("resizeStop",b,d(c));a.ui.dialog.overlay.resize()}}).css("position",k).find(".ui-resizable-se").addClass("ui-icon ui-icon-grip-diagonal-se")},_minHeight:function(){var a=this.options;return"auto"===a.height?a.minHeight:Math.min(a.minHeight,a.height)},_position:function(b){var c=[],d=[0,0],h;if(b){if("string"===typeof b||"object"===typeof b&&"0"in b)c=b.split?b.split(" "):[b[0],b[1]],1===c.length&&
(c[1]=c[0]),a.each(["left","top"],function(a,b){+c[a]===c[a]&&(d[a]=c[a],c[a]=b)}),b={my:c.join(" "),at:c.join(" "),offset:d.join(" ")};b=a.extend({},a.ui.dialog.prototype.options.position,b)}else b=a.ui.dialog.prototype.options.position;(h=this.uiDialog.is(":visible"))||this.uiDialog.show();this.uiDialog.css({top:0,left:0}).position(a.extend({of:window},b));h||this.uiDialog.hide()},_setOptions:function(b){var f=this,g={},h=!1;a.each(b,function(a,b){f._setOption(a,b);a in c&&(h=!0);a in d&&(g[a]=
b)});h&&this._size();this.uiDialog.is(":data(resizable)")&&this.uiDialog.resizable("option",g)},_setOption:function(b,c){var d=this.uiDialog;switch(b){case "beforeclose":b="beforeClose";break;case "buttons":this._createButtons(c);break;case "closeText":this.uiDialogTitlebarCloseText.text(""+c);break;case "dialogClass":d.removeClass(this.options.dialogClass).addClass("ui-dialog ui-widget ui-widget-content ui-corner-all "+c);break;case "disabled":c?d.addClass("ui-dialog-disabled"):d.removeClass("ui-dialog-disabled");
break;case "draggable":var h=d.is(":data(draggable)");h&&!c&&d.draggable("destroy");!h&&c&&this._makeDraggable();break;case "position":this._position(c);break;case "resizable":(h=d.is(":data(resizable)"))&&!c&&d.resizable("destroy");h&&"string"===typeof c&&d.resizable("option","handles",c);!h&&!1!==c&&this._makeResizable(c);break;case "title":a(".ui-dialog-title",this.uiDialogTitlebar).html(""+(c||"&#160;"))}a.Widget.prototype._setOption.apply(this,arguments)},_size:function(){var b=this.options,
c,d,h=this.uiDialog.is(":visible");this.element.show().css({width:"auto",minHeight:0,height:0});b.minWidth>b.width&&(b.width=b.minWidth);c=this.uiDialog.css({height:"auto",width:b.width}).height();d=Math.max(0,b.minHeight-c);"auto"===b.height?a.support.minHeight?this.element.css({minHeight:d,height:"auto"}):(this.uiDialog.show(),b=this.element.css("height","auto").height(),h||this.uiDialog.hide(),this.element.height(Math.max(b,d))):this.element.height(Math.max(b.height-c,0));this.uiDialog.is(":data(resizable)")&&
this.uiDialog.resizable("option","minHeight",this._minHeight())}});a.extend(a.ui.dialog,{version:"1.8.9",uuid:0,maxZ:0,getTitleId:function(a){a=a.attr("id");a||(a=this.uuid+=1);return"ui-dialog-title-"+a},overlay:function(b){this.$el=a.ui.dialog.overlay.create(b)}});a.extend(a.ui.dialog.overlay,{instances:[],oldInstances:[],maxZ:0,events:a.map("focus mousedown mouseup keydown keypress click".split(" "),function(a){return a+".dialog-overlay"}).join(" "),create:function(b){0===this.instances.length&&
(setTimeout(function(){a.ui.dialog.overlay.instances.length&&a(document).bind(a.ui.dialog.overlay.events,function(b){if(a(b.target).zIndex()<a.ui.dialog.overlay.maxZ)return!1})},1),a(document).bind("keydown.dialog-overlay",function(c){b.options.closeOnEscape&&(c.keyCode&&c.keyCode===a.ui.keyCode.ESCAPE)&&(b.close(c),c.preventDefault())}),a(window).bind("resize.dialog-overlay",a.ui.dialog.overlay.resize));var c=(this.oldInstances.pop()||a("<div></div>").addClass("ui-widget-overlay")).appendTo(document.body).css({width:this.width(),
height:this.height()});a.fn.bgiframe&&c.bgiframe();this.instances.push(c);return c},destroy:function(b){var c=a.inArray(b,this.instances);-1!=c&&this.oldInstances.push(this.instances.splice(c,1)[0]);0===this.instances.length&&a([document,window]).unbind(".dialog-overlay");b.remove();var d=0;a.each(this.instances,function(){d=Math.max(d,this.css("z-index"))});this.maxZ=d},height:function(){var b,c;return a.browser.msie&&7>a.browser.version?(b=Math.max(document.documentElement.scrollHeight,document.body.scrollHeight),
c=Math.max(document.documentElement.offsetHeight,document.body.offsetHeight),b<c?a(window).height()+"px":b+"px"):a(document).height()+"px"},width:function(){var b,c;return a.browser.msie&&7>a.browser.version?(b=Math.max(document.documentElement.scrollWidth,document.body.scrollWidth),c=Math.max(document.documentElement.offsetWidth,document.body.offsetWidth),b<c?a(window).width()+"px":b+"px"):a(document).width()+"px"},resize:function(){var b=a([]);a.each(a.ui.dialog.overlay.instances,function(){b=b.add(this)});
b.css({width:0,height:0}).css({width:a.ui.dialog.overlay.width(),height:a.ui.dialog.overlay.height()})}});a.extend(a.ui.dialog.overlay.prototype,{destroy:function(){a.ui.dialog.overlay.destroy(this.$el)}})})(jQuery);(function(a){var b=0,c=0;a.widget("ui.tabs",{options:{add:null,ajaxOptions:null,cache:!1,cookie:null,collapsible:!1,disable:null,disabled:[],enable:null,event:"click",fx:null,idPrefix:"ui-tabs-",load:null,panelTemplate:"<div></div>",remove:null,select:null,show:null,spinner:"<em>Loading&#8230;</em>",tabTemplate:'<li><a href="#{href}"><span>#{label}</span></a></li>'},_create:function(){this._tabify(!0)},_setOption:function(a,b){"selected"==a?this.options.collapsible&&b==this.options.selected||this.select(b):
(this.options[a]=b,this._tabify())},_tabId:function(a){return a.title&&a.title.replace(/\s/g,"_").replace(/[^A-Za-z0-9\-_:\.]/g,"")||this.options.idPrefix+ ++b},_sanitizeSelector:function(a){return a.replace(/:/g,"\\:")},_cookie:function(){var b=this.cookie||(this.cookie=this.options.cookie.name||"ui-tabs-"+ ++c);return a.cookie.apply(null,[b].concat(a.makeArray(arguments)))},_ui:function(a,b){return{tab:a,panel:b,index:this.anchors.index(a)}},_cleanup:function(){this.lis.filter(".ui-state-processing").removeClass("ui-state-processing").find("span:data(label.tabs)").each(function(){var b=
a(this);b.html(b.data("label.tabs")).removeData("label.tabs")})},_tabify:function(b){function c(b,d){b.css({display:""});!a.support.opacity&&d.opacity&&b[0].style.removeAttribute("filter")}this.list=this.element.find("ol,ul").eq(0);this.lis=a("li:has(a[href])",this.list);this.anchors=this.lis.map(function(){return a("a",this)[0]});this.panels=a([]);var f=this,g=this.options,h=/^#.+/;this.anchors.each(function(b,c){var d=a(c).attr("href"),e=d.split("#")[0],l;if(e&&(e===location.toString().split("#")[0]||
(l=a("base")[0])&&e===l.href))d=c.hash,c.href=d;h.test(d)?f.panels=f.panels.add(f._sanitizeSelector(d)):"#"!=d?(a.data(c,"href.tabs",d),a.data(c,"load.tabs",d.replace(/#.*$/,"")),d=f._tabId(c),c.href="#"+d,c=a("#"+d),c.length||(c=a(g.panelTemplate).attr("id",d).addClass("ui-tabs-panel ui-widget-content ui-corner-bottom").insertAfter(f.panels[b-1]||f.list),c.data("destroy.tabs",!0)),f.panels=f.panels.add(c)):g.disabled.push(b)});b?(this.element.addClass("ui-tabs ui-widget ui-widget-content ui-corner-all"),
this.list.addClass("ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all"),this.lis.addClass("ui-state-default ui-corner-top"),this.panels.addClass("ui-tabs-panel ui-widget-content ui-corner-bottom"),void 0===g.selected?(location.hash&&this.anchors.each(function(a,b){if(b.hash==location.hash)return g.selected=a,!1}),"number"!=typeof g.selected&&g.cookie&&(g.selected=parseInt(f._cookie(),10)),"number"!=typeof g.selected&&this.lis.filter(".ui-tabs-selected").length&&(g.selected=
this.lis.index(this.lis.filter(".ui-tabs-selected"))),g.selected=g.selected||(this.lis.length?0:-1)):null===g.selected&&(g.selected=-1),g.selected=0<=g.selected&&this.anchors[g.selected]||0>g.selected?g.selected:0,g.disabled=a.unique(g.disabled.concat(a.map(this.lis.filter(".ui-state-disabled"),function(a){return f.lis.index(a)}))).sort(),-1!=a.inArray(g.selected,g.disabled)&&g.disabled.splice(a.inArray(g.selected,g.disabled),1),this.panels.addClass("ui-tabs-hide"),this.lis.removeClass("ui-tabs-selected ui-state-active"),
0<=g.selected&&this.anchors.length&&(this.panels.eq(g.selected).removeClass("ui-tabs-hide"),this.lis.eq(g.selected).addClass("ui-tabs-selected ui-state-active"),f.element.queue("tabs",function(){f._trigger("show",null,f._ui(f.anchors[g.selected],f.panels[g.selected]))}),this.load(g.selected)),a(window).bind("unload",function(){f.lis.add(f.anchors).unbind(".tabs");f.lis=f.anchors=f.panels=null})):g.selected=this.lis.index(this.lis.filter(".ui-tabs-selected"));this.element[g.collapsible?"addClass":
"removeClass"]("ui-tabs-collapsible");g.cookie&&this._cookie(g.selected,g.cookie);for(var b=0,k;k=this.lis[b];b++)a(k)[-1!=a.inArray(b,g.disabled)&&!a(k).hasClass("ui-tabs-selected")?"addClass":"removeClass"]("ui-state-disabled");!1===g.cache&&this.anchors.removeData("cache.tabs");this.lis.add(this.anchors).unbind(".tabs");if("mouseover"!=g.event){var l=function(a,b){b.is(":not(.ui-state-disabled)")&&b.addClass("ui-state-"+a)};this.lis.bind("mouseover.tabs",function(){l("hover",a(this))});this.lis.bind("mouseout.tabs",
function(){a(this).removeClass("ui-state-hover")});this.anchors.bind("focus.tabs",function(){l("focus",a(this).closest("li"))});this.anchors.bind("blur.tabs",function(){a(this).closest("li").removeClass("ui-state-focus")})}var j,o;g.fx&&(a.isArray(g.fx)?(j=g.fx[0],o=g.fx[1]):j=o=g.fx);var m=o?function(b,d){a(b).closest("li").addClass("ui-tabs-selected ui-state-active");d.hide().removeClass("ui-tabs-hide").animate(o,o.duration||"normal",function(){c(d,o);f._trigger("show",null,f._ui(b,d[0]))})}:function(b,
c){a(b).closest("li").addClass("ui-tabs-selected ui-state-active");c.removeClass("ui-tabs-hide");f._trigger("show",null,f._ui(b,c[0]))},p=j?function(a,b){b.animate(j,j.duration||"normal",function(){f.lis.removeClass("ui-tabs-selected ui-state-active");b.addClass("ui-tabs-hide");c(b,j);f.element.dequeue("tabs")})}:function(a,b){f.lis.removeClass("ui-tabs-selected ui-state-active");b.addClass("ui-tabs-hide");f.element.dequeue("tabs")};this.anchors.bind(g.event+".tabs",function(){var b=this,c=a(this).closest("li"),
d=f.panels.filter(":not(.ui-tabs-hide)"),e=a(f._sanitizeSelector(this.hash));if(c.hasClass("ui-tabs-selected")&&!g.collapsible||c.hasClass("ui-state-disabled")||c.hasClass("ui-state-processing")||f._trigger("select",null,f._ui(this,e[0]))===false){this.blur();return false}g.selected=f.anchors.index(this);f.abort();if(g.collapsible){if(c.hasClass("ui-tabs-selected")){g.selected=-1;g.cookie&&f._cookie(g.selected,g.cookie);f.element.queue("tabs",function(){p(b,d)}).dequeue("tabs");this.blur();return false}if(!d.length){g.cookie&&
f._cookie(g.selected,g.cookie);f.element.queue("tabs",function(){m(b,e)});f.load(f.anchors.index(this));this.blur();return false}}g.cookie&&f._cookie(g.selected,g.cookie);if(e.length){d.length&&f.element.queue("tabs",function(){p(b,d)});f.element.queue("tabs",function(){m(b,e)});f.load(f.anchors.index(this))}else throw"jQuery UI Tabs: Mismatching fragment identifier.";a.browser.msie&&this.blur()});this.anchors.bind("click.tabs",function(){return false})},destroy:function(){var b=this.options;this.abort();
this.element.unbind(".tabs").removeClass("ui-tabs ui-widget ui-widget-content ui-corner-all ui-tabs-collapsible").removeData("tabs");this.list.removeClass("ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all");this.anchors.each(function(){var b=a.data(this,"href.tabs");b&&(this.href=b);var c=a(this).unbind(".tabs");a.each(["href","load","cache"],function(a,b){c.removeData(b+".tabs")})});this.lis.unbind(".tabs").add(this.panels).each(function(){a.data(this,"destroy.tabs")?
a(this).remove():a(this).removeClass("ui-state-default ui-corner-top ui-tabs-selected ui-state-active ui-state-hover ui-state-focus ui-state-disabled ui-tabs-panel ui-widget-content ui-corner-bottom ui-tabs-hide")});b.cookie&&this._cookie(null,b.cookie);return this},add:function(b,c,f){void 0===f&&(f=this.anchors.length);var g=this,h=this.options,c=a(h.tabTemplate.replace(/#\{href\}/g,b).replace(/#\{label\}/g,c)),b=!b.indexOf("#")?b.replace("#",""):this._tabId(a("a",c)[0]);c.addClass("ui-state-default ui-corner-top").data("destroy.tabs",
!0);var k=a("#"+b);k.length||(k=a(h.panelTemplate).attr("id",b).data("destroy.tabs",!0));k.addClass("ui-tabs-panel ui-widget-content ui-corner-bottom ui-tabs-hide");f>=this.lis.length?(c.appendTo(this.list),k.appendTo(this.list[0].parentNode)):(c.insertBefore(this.lis[f]),k.insertBefore(this.panels[f]));h.disabled=a.map(h.disabled,function(a){return a>=f?++a:a});this._tabify();1==this.anchors.length&&(h.selected=0,c.addClass("ui-tabs-selected ui-state-active"),k.removeClass("ui-tabs-hide"),this.element.queue("tabs",
function(){g._trigger("show",null,g._ui(g.anchors[0],g.panels[0]))}),this.load(0));this._trigger("add",null,this._ui(this.anchors[f],this.panels[f]));return this},remove:function(b){var c=this.options,f=this.lis.eq(b).remove(),g=this.panels.eq(b).remove();f.hasClass("ui-tabs-selected")&&1<this.anchors.length&&this.select(b+(b+1<this.anchors.length?1:-1));c.disabled=a.map(a.grep(c.disabled,function(a){return a!=b}),function(a){return a>=b?--a:a});this._tabify();this._trigger("remove",null,this._ui(f.find("a")[0],
g[0]));return this},enable:function(b){var c=this.options;if(-1!=a.inArray(b,c.disabled))return this.lis.eq(b).removeClass("ui-state-disabled"),c.disabled=a.grep(c.disabled,function(a){return a!=b}),this._trigger("enable",null,this._ui(this.anchors[b],this.panels[b])),this},disable:function(a){var b=this.options;a!=b.selected&&(this.lis.eq(a).addClass("ui-state-disabled"),b.disabled.push(a),b.disabled.sort(),this._trigger("disable",null,this._ui(this.anchors[a],this.panels[a])));return this},select:function(a){"string"==
typeof a?a=this.anchors.index(this.anchors.filter("[href$="+a+"]")):null===a&&(a=-1);-1==a&&this.options.collapsible&&(a=this.options.selected);this.anchors.eq(a).trigger(this.options.event+".tabs");return this},load:function(b){var c=this,f=this.options,g=this.anchors.eq(b)[0],h=a.data(g,"load.tabs");this.abort();if(!h||0!==this.element.queue("tabs").length&&a.data(g,"cache.tabs"))this.element.dequeue("tabs");else{this.lis.eq(b).addClass("ui-state-processing");if(f.spinner){var k=a("span",g);k.data("label.tabs",
k.html()).html(f.spinner)}this.xhr=a.ajax(a.extend({},f.ajaxOptions,{url:h,success:function(h,j){a(c._sanitizeSelector(g.hash)).html(h);c._cleanup();f.cache&&a.data(g,"cache.tabs",!0);c._trigger("load",null,c._ui(c.anchors[b],c.panels[b]));try{f.ajaxOptions.success(h,j)}catch(k){}},error:function(a,h){c._cleanup();c._trigger("load",null,c._ui(c.anchors[b],c.panels[b]));try{f.ajaxOptions.error(a,h,b,g)}catch(k){}}}));c.element.dequeue("tabs");return this}},abort:function(){this.element.queue([]);this.panels.stop(!1,
!0);this.element.queue("tabs",this.element.queue("tabs").splice(-2,2));this.xhr&&(this.xhr.abort(),delete this.xhr);this._cleanup();return this},url:function(a,b){this.anchors.eq(a).removeData("cache.tabs").data("load.tabs",b);return this},length:function(){return this.anchors.length}});a.extend(a.ui.tabs,{version:"1.8.2"});a.extend(a.ui.tabs.prototype,{rotation:null,rotate:function(a,b){var c=this,g=this.options,h=c._rotate||(c._rotate=function(b){clearTimeout(c.rotation);c.rotation=setTimeout(function(){var a=
g.selected;c.select(++a<c.anchors.length?a:0)},a);b&&b.stopPropagation()}),b=c._unrotate||(c._unrotate=!b?function(a){a.clientX&&c.rotate(null)}:function(){t=g.selected;h()});a?(this.element.bind("tabsshow",h),this.anchors.bind(g.event+".tabs",b),h()):(clearTimeout(c.rotation),this.element.unbind("tabsshow",h),this.anchors.unbind(g.event+".tabs",b),delete this._rotate,delete this._unrotate);return this}})})(jQuery);(function(a){a.storage=new a.store;a.wa.errorHandler=function(b){a.storage.del("site/"+a.wa.site.domain+"/hash");return 404==b.status?(a.wa.setHash("#/"),!1):!0};a.wa.site={options:[],domain:0,helper:"",init:function(b){"undefined"!=typeof a.History&&a.History.bind(function(){a.wa.site.dispatch()});this.domain=b.domain;this.options=b;b=window.location.hash;"#/"===b||!b?(b=a.storage.get("site/"+this.domain+"/hash"))&&null!=b?a.wa.setHash("#/"+b):this.dispatch():a.wa.setHash(b)},setHelper:function(b){if(!0===
b)return!1;b?(this.helper=b,a("#s-save-panel div.s-dropdown").show()):(this.helper="",a("#s-save-panel div.s-dropdown").hide())},dispatch:function(b){void 0==b&&(b=window.location.hash);if(b=b.replace(/^[^#]*#\/*/,""))if(b=b.split("/"),b[0]){for(var c="",d=b.length,e=0;e<b.length;e++){var f=b[e];if(2>e)if(0===e)c=f;else if("files"==c){d=e;break}else if(parseInt(f,10)!=f&&-1==f.indexOf("="))c+=f.substr(0,1).toUpperCase()+f.substr(1);else{d=e;break}else{d=e;break}}d=b.slice(d);this[c+"Action"]?(this[c+
"Action"].apply(this,d),a.storage.set("site/"+this.domain+"/hash",b.join("/"))):console&&console.log("Invalid action name:",c+"Action")}else this.defaultAction();else this.defaultAction()},defaultAction:function(){var b=a("div.s-sidebar ul.s-links a:first").attr("href");a.wa.setHash(b)},pagesAction:function(b){var c=this.parseParams(b);a("#s-content").load("?module=pages",b+"&domain_id="+this.domain,function(){a(".s-scrollable-part").scrollTop(0);a.wa.site.active(a("#page-"+c.id));a("#s-save-panel .s-bottom-fixed-bar-content-offset").addClass("s-page-editor");
var b=a("div.s-editor").height()-a("div.s-editor .s-gray-toolbar").height()-132;a("#wa-app").height()<a("#wa").height()-a("#wa-header").height()&&(b+=a("#wa").height()-a("#wa-header").height()-a("#wa-app").height());300>b&&(b=300);waEditorInit({id:"content",save_button:"s-editor-save-button",sortable:!1,height:b})})},removePageCallback:function(b){return function(){var c=a("#page-"+b),d=0<c.prev().length?c.prev().addClass("selected").find("a").attr("hash"):0<c.next().length?c.next().addClass("selected").find("a").attr("hash"):
"/pages/add/";a.wa.setHash(d);c.remove()}},pagesAddAction:function(){this.pagesAction("id=")},filesAction:function(b,c){this.savePanel(!1);if(!0===b)var d=c||this.filesPath();else d=Array.prototype.join.call(arguments,"/"),b=!1;var e=function(){a.wa.site.active(a("#s-link-files"));a("#s-files-tree li.selected").removeClass("selected");if(d){a("a.s-baseurl").removeClass("selected");a("#s-folder-actions-li").show();var b=a("#s-files-tree a[href='#/files/"+d+"']");b.parent().addClass("selected");for(b=
b.parent();b.length;){var c=b.find("> i.overhanging");c.hasClass("rarr")&&c.click();b=b.parent("ul").parent("li")}}else a("#s-folder-actions-li").hide(),a("a.s-baseurl").addClass("selected");a.wa.site.filesList(d);a("#s-upload-path").val(d||"");a("#s-current-path").html("/"+(d||""));a("#s-files-count").html("0");a("#s-files-grid input.all").removeAttr("checked")};a("#s-files-tree").length&&!b?e():a("#s-content").load("?module=files","domain_id="+this.domain,function(){a(".s-scrollable-part").scrollTop(0);
a("#s-files-tree i.overhanging").click(function(){var b=a(this);b.hasClass("rarr")?b.removeClass("rarr").addClass("darr").parent().children("ul").show():b.removeClass("darr").addClass("rarr").parent().children("ul").hide()});!0===b&&c?a.wa.setHash("#/files/"+c):e()})},filesList:function(b){b||(b=this.filesPath());a.post("?module=files&action=list",{path:b},function(b){a("#s-files-grid tr.s-file").remove();for(var d=0;d<b.data.length;d++){var e='<tr class="s-file"><td class="min-width"><input type="checkbox" value="'+
b.data[d].file+'" /></td><td><ul class="menu-h dropdown clickable"><li><a href="#"><i class="icon16 '+b.data[d].type+'"></i> '+b.data[d].file+' <i class="icon10 darr no-overhanging s-file-actions"></i></a></li></ul></td><td>'+b.data[d].datetime+'</td><td><span class="float-right">'+a.wa.site.getFileSize(b.data[d].size)+"</span></td></tr>";a("#s-files-grid").append(e)}},"json")},getFileSize:function(a){return 1024>a?a+" B":1048576>a?Math.round(a/1024)+" KB":1073741824>a?Math.round(a/1048576)+" MB":
Math.round(a/1073741824)+" GB"},checkFileType:function(a){return"image"==a||"text"==a||"script-css"==a||"script-js"==a},getFileMenu:function(b){var c=a("#s-domain").attr("href")+"wa-data/public/site/"+a.wa.site.filesPath()+b,d=a('<ul class="menu-v width-icons" style="display:block"></ul>');".php"!=b.substr(-4)&&(".phtml"!=b.substr(-6)&&"."!=b.substr(0,1))&&d.append('<li><i class="icon16 globe"></i>'+$_("File URL")+': <a href="'+c+'" target="_blank" class="bold">'+c+'<i class="icon10 new-window"></i></a></li>');
".php"!=b.substr(-4)&&".phtml"!=b.substr(-6)&&d.append('<li><a href="?module=files&action=download&path='+a.wa.site.filesPath()+"&file="+b+'"><i class="icon16 download"></i>'+$_("Download")+"</a></li>");d.append(a("<li></li>").append('<a href="#"><i class="icon16 edit"></i>'+$_("Rename")+"</a>").click(function(){a("#s-rename-dialog").waDialog({disableButtonsOnSubmit:!0,onLoad:function(){a("#s-name").val(b).focus().select();a(this).find("span").html(a.wa.site.filesPath(!0))},onSubmit:function(){var c=
a("#s-name").val();a.post("?module=files&action=rename",{path:a.wa.site.filesPath(),name:c,file:b},function(b){"ok"==b.status?(a.wa.site.filesList(),a("#s-rename-dialog").hide()):"fail"==b.status&&(alert(b.errors),a("#s-rename-dialog input[type=submit]").removeAttr("disabled"))},"json");return!1}});return!1}));d.append(a("<li></li>").append('<a href="#"><i class="icon16 move"></i>'+$_("Move to folder")+"</a>").click(function(){a("#s-move-dialog select").html(a.wa.site.filesPathOptions(a("#s-files-tree > ul.s-folderlist"),
""));a("#s-move-dialog-files").html('<input type="hidden" name="file" value="'+b+'" />');a("#s-move-dialog input[name=path]").val(a.wa.site.filesPath());a("#s-move-dialog h1 span").empty();a("#s-move-dialog").waDialog({disableButtonsOnSubmit:!0,onSubmit:function(){a.post("?module=files&action=move",a("#s-move-dialog form").serialize(),function(b){"ok"==b.status?(a("#s-move-dialog").hide(),a.wa.site.filesList()):"fail"==b.status&&(alert(b.errors),a("#s-move-dialog input[type=submit]").removeAttr("disabled"))},
"json");return!1}});return!1}));d.append(a("<li></li>").append('<a href="#"><i class="icon16 delete"></i>'+$_("Delete")+"</a>").click(function(){a("#s-delete-dialog").waDialog({content:"<h1>"+$_("Delete file")+"</h1><p>"+$_("File")+" <b>"+b+"</b> "+$_("will be deleted without the ability to recover.")+"</p>",disableButtonsOnSubmit:!0,onSubmit:function(){a.post("?module=files&action=delete",{path:a.wa.site.filesPath(),file:b},function(b){"ok"==b.status?(a.wa.site.filesList(),a("#s-delete-dialog").hide()):
"fail"==b.status&&(alert(b.errors),a("#s-delete-dialog input[type=submit]").removeAttr("disabled"))},"json")}});return!1}));return d},settingsAction:function(b){this.savePanel(!1);if(a("#s-settings-tabs").length){var c=b?a("#s-settings-tabs a[href='#"+b+"']"):a("#s-settings-tabs a:last");c.parent().hasClass("selected")||c.click();a.wa.site.active("routing"!=b?a("a#s-settings-link"):!1)}else a("#s-content").load("?module=settings&domain_id="+this.domain,function(){b?a("#s-settings-tabs a[href='#"+
b+"']").click():a("#s-settings-tabs a:last").click();a.wa.site.active("routing"!=b?a("a#s-settings-link"):!1)})},settingsRoutingAction:function(){this.settingsAction("routing")},snippetsAction:function(b){a("#s-content").load("?module=snippets",b,function(){a(".s-scrollable-part").scrollTop(0);a.wa.site.initEditor("content","app=");a.wa.site.active(a("#s-link-snippets"))})},snippetsAddAction:function(){this.snippetsAction("id=")},themesAction:function(b){this.savePanel(!1);a("#s-content").load("?module=themes",
b,function(){a(".s-scrollable-part").scrollTop(0);a.wa.site.active(a("#s-link-themes"))})},designAction:function(b){var c=this.parseParams(b);a("#s-content").load("?module=design",b+"&domain_id="+this.domain,function(){a(".s-scrollable-part").scrollTop(0);a.wa.site.initEditor("content",!0);a.wa.site.active(a("#design-"+c.route));a("ul.s-theme li.selected").removeClass("selected");""===c.file?a("#theme-"+c.theme+" li.add-file").addClass("selected"):c.file?a("#theme-"+c.theme+" li[data-file='"+c.file+
"']").addClass("selected"):c.theme?a("#theme-"+c.theme+" li:first").addClass("selected"):0<a("ul.s-theme:first li[data-file='index.html']").length?a("ul.s-theme:first li[data-file='index.html']").addClass("selected"):a("ul.s-theme:first li:first").addClass("selected")})},active:function(b){a(".sidebar a.selected").removeClass("selected");a("ul.s-links li.selected").removeClass("selected");b&&b.length&&b.addClass("selected")},routingAction:function(b){this.savePanel(!1);a("#s-content").load("?module=routing",
b+"&domain_id="+this.domain,function(){})},parseParams:function(a){if(!a)return{};var a=a.split("&"),c={};for(i=0;i<a.length;i++){var d=a[i].split("=");c[d[0]]=1<d.length?d[1]:""}return c},designAddAction:function(a){this.designAction(a+"&file=")},initEditor:function(b,c){if(!a("#"+b).length)return!1;var d=a("#"+b).attr("data-type");this.savePanel(!0);var e=a("div.s-editor.s-white").height()-a("div.s-editor.s-white .s-grey-toolbar").height()-50;300>e&&(e=300);wa_editor=CodeMirror.fromTextArea(document.getElementById(b),
{mode:d?"text/"+d:"text/html",tabMode:"indent",height:"dynamic",lineWrapping:!0,onKeyEvent:function(a,b){var c=jQuery.Event(b);"keydown"==c.type?waEditorKeyCallback(!1,{save_button:"s-editor-save-button"})(b):(c.type="keypress")&&waEditorKeyCallback(!0,{save_button:"s-editor-save-button"})(b)}});a(".CodeMirror-scroll").css("min-height",e+"px");this.setHelper(c||!1)},savePanel:function(b){b?(a("#s-save-panel").show(),a("#s-save-panel .s-bottom-fixed-bar-content-offset").removeClass("s-page-editor"),
a("#wa div.s-scrollable-part").removeClass("s-no-editor"),a("#s-editor-save-button").removeClass("yellow").addClass("green"),a("#process-message").empty()):(a("#s-save-panel").hide(),a("#wa div.s-scrollable-part").addClass("s-no-editor"))},getTreeHTML:function(a,c,d){for(var d=d||"",c="<ul"+(c?"":' style="display:none"')+' class="menu-v with-icons'+(c?" "+c:"")+'">',e="",f=0;f<a.length;f++)e="string"==typeof a[f]?a[f]:a[f].id,c+="<li>","string"!=typeof a[f]&&(c+='<i class="icon16 rarr overhanging"></i>'),
c+='<a href="#/files/'+d+e+'/"><i class="icon16 folder"></i><b>'+e+"</b></a>","string"!=typeof a[f]&&(c+=this.getTreeHTML(a[f].childs,!1,d+e+"/")),c+="</li>";return c+"</ul>"},filesPath:function(b){b=b?"wa-data/public/site/":"";return a("#s-files-tree li.selected").length?b+a("#s-files-tree li.selected a").attr("href").substr(8):b},filesPathOptions:function(b,c,d){var c=c||"",e="";""==c&&(e='<option value="">wa-data/public/site</a>',c="&nbsp;&nbsp;&nbsp;");d=d||!1;b.children("li").each(function(){var b=
d&&a(this).find("> ul > li.selected").length||!d&&a(this).hasClass("selected")?true:false,g=a(this).children("a");e=e+("<option "+(b?'selected="selected"':"")+' value="'+g.attr("href").substr(8)+'">'+c+g.children("b").html()+"</option>");if(a(this).children("ul").length&&(!d||!a(this).hasClass("selected")))e=e+a.wa.site.filesPathOptions(a(this).children("ul"),c+"&nbsp;&nbsp;&nbsp;",d)});return e}}})(jQuery);
$(function(){$(".s-add-new-site").live("click",function(){$("#addsite-dialog").waDialog({onSubmit:function(){var a=$(this);$.post(a.attr("action"),a.serialize(),function(a){"ok"==a.status&&(location.href="?domain_id="+a.data.id+"#/settings/")},"json");return!1}});return!1});$("div.s-sidebar h5.heading").click(function(){var a=$(this);a.find("i").hasClass("darr")?(a.find("i").removeClass("darr").addClass("rarr"),a.next("ul").hide(),$.storage.set("site/"+$.wa.site.domain+"/"+a.attr("data-hash"),1)):
(a.find("i").removeClass("rarr").addClass("darr"),a.next("ul").show(),$.storage.del("site/"+$.wa.site.domain+"/"+a.attr("data-hash")))});$("div.s-sidebar h5.heading").each(function(){$.storage.get("site/"+$.wa.site.domain+"/"+$(this).attr("data-hash"))&&$(this).click()});$("#s-pages").sortable({distance:5,helper:"clone",items:"li",opacity:0.75,tolerance:"pointer",stop:function(a,b){var c=$(b.item),d=c.attr("id").replace(/page-/,""),c=c.prevAll("li").size()+1;$.post("?module=pages&action=sort&domain_id="+
$.wa.site.domain,{id:d,pos:c},function(){},"json")}});$("#s-page-settings-toggle").live("click",function(){$("#s-page-settings").toggle();return!1});$("#s-editor-save-button").click(function(){$("#site-form").submit()});$("#s-domains-menu h1").click(function(){var a=$("#s-domains-menu ul.menu-v");if(a.is(":visible"))return a.hide(),!1;a.show();$(document).one("click",function(){a.hide()});return!1});$("#s-helper-link").click(function(){if($("#s-helper").is(":visible"))return $("#s-helper").hide(),
!1;$("#s-helper").load("?module=helper",$.wa.site.helper,function(){$(this).show();var a=function(b){if("s-helper"==$(b.target).attr("id")||$(b.target).parents("#s-helper").length)$(document).one("click",a);else $("#s-helper").hide()};$(document).one("click",a)});return!1});$("#s-helper div.fields a.inline-link").live("click",function(){var a=$(this).find("i");a.children("b").length&&(a=a.children("b"));if($(".el-rte").length&&$(".el-rte").is(":visible"))try{$("#content").elrte()[0].elrte.selection.insertHtml(a.text())}catch(b){}else wa_editor.replaceSelection(a.text());
return!1});$("#wa-app > div.s-sidebar a, #wa-header a, #s-content > div.sidebar a").live("click",function(){if($("#s-save-panel").is(":visible")&&$("#s-editor-save-button").hasClass("yellow"))return confirm($_("Unsaved changes will be lost if you leave this page now. Are you sure?"))});$("#site-form").live("submit",function(){waEditorUpdateSource({id:"content"});var a=$(this);$("#process-message").html("<i class='icon16 loading'></i> "+$_("Saving...")).fadeIn("slow");$.post(a.attr("action"),a.serialize(),
function(b){if("ok"==b.status)$(".error").removeClass("error"),$("#process-message").html('<i class="icon16 yes"></i>'+$_("Saved")).fadeOut("slow"),$("#s-editor-save-button").removeClass("yellow").removeClass("red").addClass("green"),a.trigger("response",[b]);else if("fail"==b.status){if($.isArray(b.errors)){var c=b.errors[0];$(b.errors[1]).addClass("error")}else c=b.errors;$("#process-message").html('<b style="color:red">'+(c?c:$_("An error occurred while saving"))+"</b>");$("#s-editor-save-button").removeClass("yellow").removeClass("green").addClass("red")}},
"json");$(".el-rte").length&&$(".el-rte").is(":visible");return!1})});
