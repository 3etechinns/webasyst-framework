var WaLoginAbstractForm=function(t){var e=function(){},r=e;r.className="WaLoginAbstractForm",r.def=function(t,e){for(var r=0,o=arguments.length;r<o;r++)if(void 0!==arguments[r])return arguments[r]};var o=r.def;return r.inherit=function(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t},r.prototype.init=function(t){var e=this;e.initVars(t),e.initSubmit(),e.initErrorsAutoCleaner(),e.showErrors(e.errors),e.setFocus(),e.initCaptcha()},r.prototype.initVars=function(e){var a=this;e=e||{},a.$wrapper=o(a.$wrapper,e.$wrapper,t()),a.$form||(a.$form=a.$wrapper.find(".js-wa-form-item"),a.$form.length||(a.$form=a.$wrapper.find("form")),a.$form.length||(a.$form=t())),a.namespace=o(a.namespace,e.namespace,""),a.$templates=o(a.$templates,e.$templates,{}),a.$templates=t.extend({error_msg:t('<em class="wa-error-msg"></em>'),info_msg:t('<div class="wa-info-msg"></div>')},a.$templates),a.classes=o(a.classes,e.classes,{}),a.classes=t.extend({error_input:"wa-error",error_msg:"wa-error-msg",uncaught_errors:"wa-uncaught-errors",messages:"wa-info-messages",messages_wrapper:"wa-info-messages-wrapper",message_msg:"wa-info-msg",field:"field"},a.classes),a.errors=o(a.errors,e.errors,{}),a.is_errors=!t.isEmptyObject(a.errors),a.locale=o(a.locale,e.locale,{}),a.js_validate=o(a.js_validate,e.js_validate,!0),a.is_json_mode=o(a.is_json_mode,e.is_json_mode),a.className=o(a.className,r.className),a.$captcha=o(a.$captcha,a.$wrapper.find(".wa-captcha-field")),a.need_redirects=void 0===e.need_redirects||!!e.need_redirects,a.env="",a.form_type=""},r.prototype.getFormItem=function(){return this.$form},r.prototype.getFormAction=function(){var t=this;return t.$form.is("form")?t.$form.attr("action"):t.$form.data("action")},r.prototype.getSerializedFormData=function(){var t=this,e=t.getFormItem();return e.is("form")?e.serializeArray():e.find(":input:not(:disabled)").serializeArray()},r.prototype.beforeSubmit=function(){var t=this,e=t.getFormItem(),r=function(){var t=document.cookie.match(new RegExp("(?:^|; )_csrf=([^;]*)"));return t&&t[1]?decodeURIComponent(t[1]):""};e.find('[name="_csrf"]').val(r)},r.prototype.setFocus=function(){},r.prototype.triggerEvent=function(t){var e=this,r={env:e.env,form_type:e.form_type,form_wrapper_id:e.$wrapper.attr("id")},o=Array.prototype.slice.call(arguments),o=o.slice(1);e.$wrapper.trigger(t,o.concat([r]))},r.prototype.initCaptcha=function(){var e=this;e.$wrapper.find(".wa-captcha-field").length?t(window).one("wa_recaptcha_loaded wa_captcha_loaded",function(){e.triggerEvent("wa_auth_form_loaded"),e.triggerEvent("wa_auth_form_change_view")}):e.triggerEvent("wa_auth_form_loaded")},r.prototype.turnOffBlock=function(e){var r=this;e.hide(),e.find(":input").attr("disabled",!0),e.find("[type=button],:submit").each(function(){var e=t(this),o=t('<div class="wa-js-old-button-place"></div>'),a=t('<div class="wa-js-new-button-place"></div>');e.after(o),o.data("button",e),a.hide(),r.getFormItem().append(a),a.html(e)}),r.triggerEvent("wa_auth_form_change_view")},r.prototype.turnOnBlock=function(e){var r=this;e.find(".wa-js-old-button-place").each(function(){var e=t(this),r=e.data("button"),o=r.parent();e.after(r),e.remove(),o.remove()}),e.show().find(":input").attr("disabled",!1),r.triggerEvent("wa_auth_form_change_view")},r.prototype.isJsonMode=function(){return this.is_json_mode},r.prototype.formatInfoMessage=function(e,r,o){r=void 0===r||r;var a=this,n=a.$templates.info_msg,i=n.clone();return void 0!==o&&i.data("name",o).attr("data-name",o),r?i.text(t.trim(""+e)):i.html(t.trim(""+e))},r.prototype.getInfoMessages=function(t){var e=this,r=e.$wrapper,o="."+e.classes.message_msg;return t&&(o+='[data-name="'+t+'"]'),r.find(o)},r.prototype.clearInfoMessages=function(t){var e=this;e.getInfoMessages(t).remove(),e.triggerEvent("wa_auth_form_change_view")},r.prototype.showInfoMessages=function(e){var r=this,o=r.$wrapper,a=o.find("."+r.classes.messages);t.each(e||{},function(e,o){var n=r.getFormInput(e);"string"==typeof o&&(o=[o]);var i=[];t.each(o||[],function(t,o){var a=r.formatInfoMessage(o,!1,e);a.data("index",t).attr("data-index",t),i.push(a)}),n.length?n.after(i):a.show().append(i)}),r.triggerEvent("wa_auth_form_change_view")},r.prototype.clearErrors=function(){var t=this;if(t.is_errors){var e=t.$wrapper;e.find("."+t.classes.error_input).removeClass(t.classes.error_input),e.find("."+t.classes.error_msg).not("[data-not-clear=1]").remove(),e.find("."+t.classes.uncaught_errors).find("."+t.classes.error_msg).length<=0&&e.find("."+t.classes.uncaught_errors).hide(),t.is_errors=!1,t.triggerEvent("wa_auth_form_change_view")}},r.prototype.getErrorTemplate=function(t){return this.$templates.error_msg},r.prototype.escape=function(e){var r=t("<div>");return r.text(t.trim(""+e)),e=r.text(),r.remove(),e},r.prototype.prepareErrorText=function(t,e){return this.escape(e)},r.prototype.prepareErrorItem=function(t,e,r){var o=this,a=o.getErrorTemplate(t).clone(),n=a.clone();return n.data("name",t).data("index",r).attr("data-name",t).attr("data-index",r),n.html(o.prepareErrorText(t,e)),n},r.prototype.showInputError=function(t,e){var r=this,o=r.getFormInput(t);return!!o.length&&(o.parent().append(e),o.addClass(r.classes.error_input),!0)},r.prototype.getFormInput=function(t){var e=this,r=e.getFormItem(),o=e.buildFormInputName(t);return r.find('[name="'+o+'"]')},r.prototype.buildFormInputName=function(t){var e=this,r=e.namespace;return r?r+"["+t+"]":t},r.prototype.getFormField=function(t){var e=this;return e.$wrapper.find("."+e.classes.field+'[data-field-id="'+t+'"]')},r.prototype.showUncaughtErrors=function(t,e,r){var o=this,a=o.$wrapper,n=a.find("."+o.classes.uncaught_errors);return!!n.length&&(n.show(),r&&n.html(""),n.show().append(e),!0)},r.prototype.afterShowErrors=function(){},r.prototype.showErrors=function(e){var r=this;t.each(e||{},function(e,o){"string"==typeof o&&(o=[o]);var a=r.prepareErrorItems(e,o),n=r.showInputError(e,a);n||(n=r.showUncaughtErrors(e,a,!0)),!n&&console&&console.error&&t.each(a,function(){var e="Uncaught validate error: "+t(this).text();console.error(e)})}),r.is_errors=!0,r.afterShowErrors(),r.triggerEvent("wa_auth_form_change_view")},r.prototype.isJsonMode=function(){return this.is_json_mode},r.prototype.initSubmit=function(){var e=this,r=e.getFormItem(),o=null,a=function(t){var r=e.onSubmit(t);r&&(o&&o.abort(),o=r)};r.is("form")?r.submit(function(t){a(t)}):(r.find(":submit,button").not(":disabled").click(function(e){t(this).data("ignore")||(e.preventDefault(),a(e))}),r.on("keydown","input",function(t){13==t.keyCode&&(t.preventDefault(),r.find(":submit,button").not(":disabled").filter(":first").trigger("click"))}))},r.prototype.validate=function(){return{}},r.prototype.initErrorsAutoCleaner=function(){var e=this,r=e.getFormItem();r.on("change",":input",function(){e.clearErrors()});var o={},a=e.buildFormInputName("captcha"),n=":text:not([name="+a+"]),:password";r.find(n).each(function(){var e=t(this),r=e.attr("name"),a=e.val();o[r]={val:t.trim(a||""),timer:null}}),r.on("keydown",n,function(r){if(13!=r.keyCode){var a=t(this),n=a.attr("name"),i=o[n]||{},s=t.trim(i.val||""),p=i.timer||null;p&&clearTimeout(p),i.timer=setTimeout(function(){var r=t.trim(a.val()||"");r!==s&&e.clearErrors(),i.val=r},300)}})},r.prototype.onDoneSubmitHandlers=function(){var t=this;return{errors:function(e,r){return t.showErrors(e),!0},redirect:function(t){return window.location.href=t,!0},messages:function(e){return t.showInfoMessages(e),!0},rest:function(t){return!0}}},r.prototype.onDoneSubmit=function(e){var r=this,o=r.onDoneSubmitHandlers(),a=e&&"ok"===e.status,n=e&&e.data||{},i=n.messages||{},s=e&&e.errors||{};if(a||!(o.errors&&o.errors(s,e))){if(r.isRedirectResponse(e)){var p=r.getRedirectUrl(e);if(o.redirect&&o.redirect(p,e))return}!t.isEmptyObject(i)&&(o.messages&&o.messages(i,e))||o.rest&&o.rest(e)}},r.prototype.submit=function(e){e=e||{};var r=this;if(r.beforeSubmit(),r.clearErrors(),r.js_validate){var o=r.validate();if(!t.isEmptyObject(o))return void r.showErrors(o)}var a=r.getFormItem(),n=e.$button||a.find(":submit"),i=e.$loading||a.find(".wa-loading"),s=e.url||r.getFormAction(),p=r.getSerializedFormData();return i.show(),n.attr("disabled",!0),r.jsonPost(s,p).done(function(t){r.isRedirectResponse(t)||(n.attr("disabled",!1),i.hide()),r.onDoneSubmit(t)}).fail(function(){n.attr("disabled",!1)})},r.prototype.onSubmit=function(t){var e=this;if(e.isJsonMode())return t.preventDefault(),e.submit()},r.prototype.mixinVarsInData=function(e,r){return t.isPlainObject(r)?r=t.extend(r,e):t.isArray(r)?t.each(e,function(t,e){r.push({name:t,value:e})}):r&&t.each(e,function(t,e){r+="&"+t+"="+e}),r},r.prototype.beforeJsonPost=function(t,e){var r=this,o={wa_json_mode:1,need_redirects:r.need_redirects?1:0};return e=r.mixinVarsInData(o,e)},r.prototype.isRedirectResponse=function(t){return null!==this.getRedirectUrl(t)},r.prototype.getRedirectUrl=function(t){var e=t&&"ok"===t.status&&t.data&&t.data.redirect_url;return"string"==typeof e?e:null},r.prototype.jsonPost=function(e,r){var o=this;return r=o.beforeJsonPost(e,r),t.post(e,r,"json").always(function(e){o.isRedirectResponse(e)||t(".wa-captcha-refresh").trigger("click")})},r.prototype.beforeErrorTimerStart=function(){},r.prototype.afterErrorTimerStart=function(){},r.prototype.prepareTimeoutErrorItem=function(t,e){var r=this,o=r.prepareErrorItem("timeout",t);return r.beforeErrorTimerStart(),o.data("notClear",1).attr("data-not-clear",1),r.runTimeoutMessage(o,{timeout:e,onFinish:function(){o.remove(),r.afterErrorTimerStart()}}),o},r.prototype.prepareErrorItems=function(e,r){var o=this,a=[];if("timeout"===e){var n=r.message,i=r.timeout,s=o.prepareTimeoutErrorItem(n,i);a=[s]}else t.each(r||[],function(t,r){var n;n="timeout"===t?o.prepareTimeoutErrorItem(r.message,r.timeout):o.prepareErrorItem(e,r,t),a.push(n)});return a},r.prototype.runTimeoutMessage=function(t,e){var r=this,o=e.timeout,a=t.html(),n=e.onFinish;if(o=parseInt(o,10),o=!isNaN(o)&&o>0?o:60,n="function"==typeof n?n:null,a.match(/\d+:\d/)){r.triggerEvent("wa_auth_form_change_view");var i=setInterval(function(){if((o-=1)<=0)return clearInterval(i),t.remove(),void(n&&n());var e=t.html(),r=parseInt(o/60,10),a=o%60,s=r<=9?"0"+r:r,p=a<=9?"0"+a:a;e=e.replace(/\d+:\d+/,s+":"+p),t.html(e)},1e3)}},r}(jQuery),WaLoginAbstractForgotPasswordForm=function(t){var e=WaLoginAbstractForgotPasswordForm=function(){};e.className="WaLoginAbstractForgotPasswordForm";var r=WaLoginAbstractForm,o=WaLoginAbstractForm.def;return WaLoginAbstractForm.inherit(e,r),e.prototype.init=function(t){var e=this;r.prototype.init.call(e,t)},e.prototype.initVars=function(a){var n=this;n.classes=o(n.classes,{}),n.classes=t.extend({hide_wrapper:"wa-hide-wrapper"},n.classes),n.timeout=o(n.timeout,0),n.timeout=isNaN(n.timeout)||n.timeout<=0?60:n.timeout,n.login_url=o(n.login_url,""),n.className=o(n.className,e.className),r.prototype.initVars.call(n,a),n.form_type="forgotpassword"},e.prototype.showErrors=function(t){var e=this;r.prototype.showErrors.call(e,t)},e.prototype.onDoneSubmitHandlers=function(){var t=this,e=r.prototype.onDoneSubmitHandlers.call(t);return e.messages=function(e){return t.showSentMessages(e)||t.showInfoMessages(e),!0},e},e.prototype.keysCount=function(e){if(e=e||{},Object.keys)return Object.keys(e).length;var r=0;return t.each(e,function(){r++}),r},e.prototype.makeDiv=function(e){return t("<div>").addClass(e)},e.prototype.makeA=function(e,r){return t("<a>").attr("href",e).html(r)},e.prototype.showSentMessages=function(t){var e=this,r=e.keysCount(t);if(!t.sent||1!==r)return!1;e.showInfoMessages(t);var o=e.$wrapper,a=o.find("."+e.classes.messages),n=e.makeDiv(e.classes.messages_wrapper),i=e.makeDiv(e.classes.hide_wrapper),s=o.children();return o.append(n),o.append(i.hide()),i.append(s),n.append(a),n.append(e.makeA(e.login_url,e.locale.login_page)),!0},e.prototype.validate=function(){var e=this,r=e.getSerializedFormData(),o={};return t.each(r,function(r,a){var n=a.name,i=t.trim(a.value||"");return n!==e.buildFormInputName("login")||i?n!==e.buildFormInputName("captcha")||i?n!==e.buildFormInputName("confirmation_code")||i?void 0:void(o.confirmation_code=[e.locale.confirmation_code_required||e.locale.required||""]):void(o.captcha=[e.locale.captcha_required||e.locale.required||""]):void(o.login=[e.locale.login_required||e.locale.required||""])}),o},e}(jQuery),WaBackendForgotPassword=function(t){var e=function(e){var r=this;r.$wrapper=e.$wrapper,r.$form=r.$wrapper.find("form"),r.namespace=e.namespace||"",r.$templates={error_msg:t('<em class="wa-error-msg"></em>'),info_msg:t('<div class="wa-info-msg"></div>')},r.classes={error_input:"wa-error",error_msg:"wa-error-msg",uncaught_errors:"wa-uncaught-errors",field:"field"},r.errors=e.errors||{},r.locale=e.locale||{},r.timeout=parseInt(e.timeout,10),r.timeout=isNaN(r.timeout)||r.timeout<=0?60:r.timeout,r.init(e),r.$wrapper.data("WaAuthForm",r)},r=e;r.className="WaBackendForgotPassword";var o=WaLoginAbstractForgotPasswordForm;return WaLoginAbstractForm.inherit(r,o),r.prototype.initVars=function(t){var e=this;e.className=r.className,o.prototype.initVars.call(e,t),e.is_json_mode=!0,e.env="backend"},r.prototype.init=function(t){var e=this;o.prototype.init.call(e,t),e.activateInitialView(),e.$wrapper.find(".wa-edit-login-link").click(function(t){t.preventDefault(),e.activateInitialView()});var r=e.$wrapper.find(".wa-send-again-confirmation-code-link");r.click(function(t){t.preventDefault(),e.getFormInput("confirmation_code").attr("disabled",!0),e.submit({$button:r,$loading:e.$wrapper.find(".wa-send-again-confirmation-code-link-loading")}),e.getFormInput("confirmation_code").attr("disabled",!1)})},r.prototype.activateInitialView=function(){var t=this;t.$wrapper.removeClass("wa-with-confirmation-code"),t.getFormInput("confirmation_code").attr("disabled",!0),t.getFormInput("login").removeAttr("readonly"),t.$wrapper.find(".wa-edit-login-link-wrapper").hide()},r.prototype.activateConfirmationView=function(){var t=this;t.$wrapper.addClass("wa-with-confirmation-code");var e=t.getFormInput("confirmation_code");e.attr("disabled",!1),e.val(""),t.getFormInput("login").attr("readonly",1)},r.prototype.onDoneSubmitHandlers=function(){var t=this,e=o.prototype.onDoneSubmitHandlers.call(t),r=function(e){t.activateConfirmationView();var r=t.formatInfoMessage(e.data.timeout_message,!1);t.$wrapper.find(".wa-confirmation-code-input-message").html(r);var o=t.$wrapper.find(".wa-edit-login-link-wrapper").hide(),a=t.$wrapper.find(".wa-send-again-confirmation-code-link-wrapper").hide();t.runTimeoutMessage(r,{timeout:e.data.timeout,onFinish:function(){o.show(),a.show()}})},a=function(e){t.$wrapper.find("."+t.classes.message_msg).html(""),t.showInfoMessages({sent:e.data.sent_message}),t.turnOffBlock(t.getFormField("login")),t.turnOffBlock(t.getFormField("captcha")),t.turnOffBlock(t.$wrapper.find(".wa-field-submit")),t.$wrapper.find(".wa-back-to-login-page-link-wrapper").show()};return e.rest=function(t){"sms"===t.data.channel_type?r(t):a(t)},e},r}(jQuery);
//# sourceMappingURL=forgotpassword-backend-form.min.js.map
