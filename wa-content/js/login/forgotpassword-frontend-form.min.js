var WaLoginAbstractForm=function(t){var r=function(){},e=r;e.className="WaLoginAbstractForm",e.def=function(t,r){for(var e=0,o=arguments.length;e<o;e++)if(void 0!==arguments[e])return arguments[e]};var o=e.def;return e.inherit=function(t,r){t.prototype=Object.create(r.prototype),t.prototype.constructor=t},e.prototype.init=function(t){var r=this;r.initVars(t),r.initSubmit(),r.initErrorsAutoCleaner(),r.showErrors(r.errors),r.setFocus(),r.initCaptcha()},e.prototype.initVars=function(r){var n=this;r=r||{},n.$wrapper=o(n.$wrapper,r.$wrapper,t()),n.$form||(n.$form=n.$wrapper.find(".js-wa-form-item"),n.$form.length||(n.$form=n.$wrapper.find("form")),n.$form.length||(n.$form=t())),n.namespace=o(n.namespace,r.namespace,""),n.$templates=o(n.$templates,r.$templates,{}),n.$templates=t.extend({error_msg:t('<em class="wa-error-msg"></em>'),info_msg:t('<div class="wa-info-msg"></div>')},n.$templates),n.classes=o(n.classes,r.classes,{}),n.classes=t.extend({error_input:"wa-error",error_msg:"wa-error-msg",uncaught_errors:"wa-uncaught-errors",messages:"wa-info-messages",messages_wrapper:"wa-info-messages-wrapper",message_msg:"wa-info-msg",field:"field"},n.classes),n.errors=o(n.errors,r.errors,{}),n.is_errors=!t.isEmptyObject(n.errors),n.locale=o(n.locale,r.locale,{}),n.js_validate=o(n.js_validate,r.js_validate,!0),n.is_json_mode=o(n.is_json_mode,r.is_json_mode),n.className=o(n.className,e.className),n.$captcha=o(n.$captcha,n.$wrapper.find(".wa-captcha-field")),n.need_redirects=void 0===r.need_redirects||!!r.need_redirects,n.env="",n.form_type=""},e.prototype.getFormItem=function(){return this.$form},e.prototype.getFormAction=function(){var t=this;return t.$form.is("form")?t.$form.attr("action"):t.$form.data("action")},e.prototype.getSerializedFormData=function(){var t=this,r=t.getFormItem();return r.is("form")?r.serializeArray():r.find(":input:not(:disabled)").serializeArray()},e.prototype.beforeSubmit=function(){var t=this,r=t.getFormItem(),e=function(){var t=document.cookie.match(new RegExp("(?:^|; )_csrf=([^;]*)"));return t&&t[1]?decodeURIComponent(t[1]):""};r.find('[name="_csrf"]').val(e)},e.prototype.setFocus=function(){},e.prototype.triggerEvent=function(t){var r=this,e={env:r.env,form_type:r.form_type,form_wrapper_id:r.$wrapper.attr("id")},o=Array.prototype.slice.call(arguments),o=o.slice(1);r.$wrapper.trigger(t,o.concat([e]))},e.prototype.initCaptcha=function(){var r=this;r.$wrapper.find(".wa-captcha-field").length?t(window).one("wa_recaptcha_loaded wa_captcha_loaded",function(){r.triggerEvent("wa_auth_form_loaded"),r.triggerEvent("wa_auth_form_change_view")}):r.triggerEvent("wa_auth_form_loaded")},e.prototype.turnOffBlock=function(r){var e=this;r.hide(),r.find(":input").attr("disabled",!0),r.find("[type=button],:submit").each(function(){var r=t(this),o=t('<div class="wa-js-old-button-place"></div>'),n=t('<div class="wa-js-new-button-place"></div>');r.after(o),o.data("button",r),n.hide(),e.getFormItem().append(n),n.html(r)}),e.triggerEvent("wa_auth_form_change_view")},e.prototype.turnOnBlock=function(r){var e=this;r.find(".wa-js-old-button-place").each(function(){var r=t(this),e=r.data("button"),o=e.parent();r.after(e),r.remove(),o.remove()}),r.show().find(":input").attr("disabled",!1),e.triggerEvent("wa_auth_form_change_view")},e.prototype.isJsonMode=function(){return this.is_json_mode},e.prototype.formatInfoMessage=function(r,e,o){e=void 0===e||e;var n=this,a=n.$templates.info_msg,i=a.clone();return void 0!==o&&i.data("name",o).attr("data-name",o),e?i.text(t.trim(""+r)):i.html(t.trim(""+r))},e.prototype.getInfoMessages=function(t){var r=this,e=r.$wrapper,o="."+r.classes.message_msg;return t&&(o+='[data-name="'+t+'"]'),e.find(o)},e.prototype.clearInfoMessages=function(t){var r=this;r.getInfoMessages(t).remove(),r.triggerEvent("wa_auth_form_change_view")},e.prototype.showInfoMessages=function(r){var e=this,o=e.$wrapper,n=o.find("."+e.classes.messages);t.each(r||{},function(r,o){var a=e.getFormInput(r);"string"==typeof o&&(o=[o]);var i=[];t.each(o||[],function(t,o){var n=e.formatInfoMessage(o,!1,r);n.data("index",t).attr("data-index",t),i.push(n)}),a.length?a.after(i):n.show().append(i)}),e.triggerEvent("wa_auth_form_change_view")},e.prototype.clearErrors=function(){var t=this;if(t.is_errors){var r=t.$wrapper;r.find("."+t.classes.error_input).removeClass(t.classes.error_input),r.find("."+t.classes.error_msg).not("[data-not-clear=1]").remove(),r.find("."+t.classes.uncaught_errors).find("."+t.classes.error_msg).length<=0&&r.find("."+t.classes.uncaught_errors).hide(),t.is_errors=!1,t.triggerEvent("wa_auth_form_change_view")}},e.prototype.getErrorTemplate=function(t){return this.$templates.error_msg},e.prototype.escape=function(r){var e=t("<div>");return e.text(t.trim(""+r)),r=e.text(),e.remove(),r},e.prototype.prepareErrorText=function(t,r){return this.escape(r)},e.prototype.prepareErrorItem=function(t,r,e){var o=this,n=o.getErrorTemplate(t).clone(),a=n.clone();return a.data("name",t).data("index",e).attr("data-name",t).attr("data-index",e),a.html(o.prepareErrorText(t,r)),a},e.prototype.showInputError=function(t,r){var e=this,o=e.getFormInput(t);return!!o.length&&(o.parent().append(r),o.addClass(e.classes.error_input),!0)},e.prototype.getFormInput=function(t){var r=this,e=r.getFormItem(),o=r.buildFormInputName(t);return e.find('[name="'+o+'"]')},e.prototype.buildFormInputName=function(t){var r=this,e=r.namespace;return e?e+"["+t+"]":t},e.prototype.getFormField=function(t){var r=this;return r.$wrapper.find("."+r.classes.field+'[data-field-id="'+t+'"]')},e.prototype.showUncaughtErrors=function(t,r,e){var o=this,n=o.$wrapper,a=n.find("."+o.classes.uncaught_errors);return!!a.length&&(a.show(),e&&a.html(""),a.show().append(r),!0)},e.prototype.afterShowErrors=function(){},e.prototype.showErrors=function(r){var e=this;t.each(r||{},function(r,o){"string"==typeof o&&(o=[o]);var n=e.prepareErrorItems(r,o),a=e.showInputError(r,n);a||(a=e.showUncaughtErrors(r,n,!0)),!a&&console&&console.error&&t.each(n,function(){var r="Uncaught validate error: "+t(this).text();console.error(r)})}),e.is_errors=!0,e.afterShowErrors(),e.triggerEvent("wa_auth_form_change_view")},e.prototype.isJsonMode=function(){return this.is_json_mode},e.prototype.initSubmit=function(){var r=this,e=r.getFormItem(),o=null,n=function(t){var e=r.onSubmit(t);e&&(o&&o.abort(),o=e)};e.is("form")?e.submit(function(t){n(t)}):(e.find(":submit,button").not(":disabled").click(function(r){t(this).data("ignore")||(r.preventDefault(),n(r))}),e.on("keydown","input",function(t){13==t.keyCode&&(t.preventDefault(),e.find(":submit,button").not(":disabled").filter(":first").trigger("click"))}))},e.prototype.validate=function(){return{}},e.prototype.initErrorsAutoCleaner=function(){var r=this,e=r.getFormItem();e.on("change",":input",function(){r.clearErrors()});var o={},n=r.buildFormInputName("captcha"),a=":text:not([name="+n+"]),:password";e.find(a).each(function(){var r=t(this),e=r.attr("name"),n=r.val();o[e]={val:t.trim(n||""),timer:null}}),e.on("keydown",a,function(e){if(13!=e.keyCode){var n=t(this),a=n.attr("name"),i=o[a]||{},s=t.trim(i.val||""),p=i.timer||null;p&&clearTimeout(p),i.timer=setTimeout(function(){var e=t.trim(n.val()||"");e!==s&&r.clearErrors(),i.val=e},300)}})},e.prototype.onDoneSubmitHandlers=function(){var t=this;return{errors:function(r,e){return t.showErrors(r),!0},redirect:function(t){return window.location.href=t,!0},messages:function(r){return t.showInfoMessages(r),!0},rest:function(t){return!0}}},e.prototype.onDoneSubmit=function(r){var e=this,o=e.onDoneSubmitHandlers(),n=r&&"ok"===r.status,a=r&&r.data||{},i=a.messages||{},s=r&&r.errors||{};if(n||!(o.errors&&o.errors(s,r))){if(e.isRedirectResponse(r)){var p=e.getRedirectUrl(r);if(o.redirect&&o.redirect(p,r))return}!t.isEmptyObject(i)&&(o.messages&&o.messages(i,r))||o.rest&&o.rest(r)}},e.prototype.submit=function(r){r=r||{};var e=this;if(e.beforeSubmit(),e.clearErrors(),e.js_validate){var o=e.validate();if(!t.isEmptyObject(o))return void e.showErrors(o)}var n=e.getFormItem(),a=r.$button||n.find(":submit"),i=r.$loading||n.find(".wa-loading"),s=r.url||e.getFormAction(),p=e.getSerializedFormData();return i.show(),a.attr("disabled",!0),e.jsonPost(s,p).done(function(t){e.isRedirectResponse(t)||(a.attr("disabled",!1),i.hide()),e.onDoneSubmit(t)}).fail(function(){a.attr("disabled",!1)})},e.prototype.onSubmit=function(t){var r=this;if(r.isJsonMode())return t.preventDefault(),r.submit()},e.prototype.mixinVarsInData=function(r,e){return t.isPlainObject(e)?e=t.extend(e,r):t.isArray(e)?t.each(r,function(t,r){e.push({name:t,value:r})}):e&&t.each(r,function(t,r){e+="&"+t+"="+r}),e},e.prototype.beforeJsonPost=function(t,r){var e=this,o={wa_json_mode:1,need_redirects:e.need_redirects?1:0};return r=e.mixinVarsInData(o,r)},e.prototype.isRedirectResponse=function(t){return null!==this.getRedirectUrl(t)},e.prototype.getRedirectUrl=function(t){var r=t&&"ok"===t.status&&t.data&&t.data.redirect_url;return"string"==typeof r?r:null},e.prototype.jsonPost=function(r,e){var o=this;return e=o.beforeJsonPost(r,e),t.post(r,e,"json").always(function(r){o.isRedirectResponse(r)||t(".wa-captcha-refresh").trigger("click")})},e.prototype.beforeErrorTimerStart=function(){},e.prototype.afterErrorTimerStart=function(){},e.prototype.prepareTimeoutErrorItem=function(t,r){var e=this,o=e.prepareErrorItem("timeout",t);return e.beforeErrorTimerStart(),o.data("notClear",1).attr("data-not-clear",1),e.runTimeoutMessage(o,{timeout:r,onFinish:function(){o.remove(),e.afterErrorTimerStart()}}),o},e.prototype.prepareErrorItems=function(r,e){var o=this,n=[];if("timeout"===r){var a=e.message,i=e.timeout,s=o.prepareTimeoutErrorItem(a,i);n=[s]}else t.each(e||[],function(t,e){var a;a="timeout"===t?o.prepareTimeoutErrorItem(e.message,e.timeout):o.prepareErrorItem(r,e,t),n.push(a)});return n},e.prototype.runTimeoutMessage=function(t,r){var e=this,o=r.timeout,n=t.html(),a=r.onFinish;if(o=parseInt(o,10),o=!isNaN(o)&&o>0?o:60,a="function"==typeof a?a:null,n.match(/\d+:\d/)){e.triggerEvent("wa_auth_form_change_view");var i=setInterval(function(){if((o-=1)<=0)return clearInterval(i),t.remove(),void(a&&a());var r=t.html(),e=parseInt(o/60,10),n=o%60,s=e<=9?"0"+e:e,p=n<=9?"0"+n:n;r=r.replace(/\d+:\d+/,s+":"+p),t.html(r)},1e3)}},e}(jQuery),WaLoginAbstractForgotPasswordForm=function(t){var r=WaLoginAbstractForgotPasswordForm=function(){};r.className="WaLoginAbstractForgotPasswordForm";var e=WaLoginAbstractForm,o=WaLoginAbstractForm.def;return WaLoginAbstractForm.inherit(r,e),r.prototype.init=function(t){var r=this;e.prototype.init.call(r,t)},r.prototype.initVars=function(n){var a=this;a.classes=o(a.classes,{}),a.classes=t.extend({hide_wrapper:"wa-hide-wrapper"},a.classes),a.timeout=o(a.timeout,0),a.timeout=isNaN(a.timeout)||a.timeout<=0?60:a.timeout,a.login_url=o(a.login_url,""),a.className=o(a.className,r.className),e.prototype.initVars.call(a,n),a.form_type="forgotpassword"},r.prototype.showErrors=function(t){var r=this;e.prototype.showErrors.call(r,t)},r.prototype.onDoneSubmitHandlers=function(){var t=this,r=e.prototype.onDoneSubmitHandlers.call(t);return r.messages=function(r){return t.showSentMessages(r)||t.showInfoMessages(r),!0},r},r.prototype.keysCount=function(r){if(r=r||{},Object.keys)return Object.keys(r).length;var e=0;return t.each(r,function(){e++}),e},r.prototype.makeDiv=function(r){return t("<div>").addClass(r)},r.prototype.makeA=function(r,e){return t("<a>").attr("href",r).html(e)},r.prototype.showSentMessages=function(t){var r=this,e=r.keysCount(t);if(!t.sent||1!==e)return!1;r.showInfoMessages(t);var o=r.$wrapper,n=o.find("."+r.classes.messages),a=r.makeDiv(r.classes.messages_wrapper),i=r.makeDiv(r.classes.hide_wrapper),s=o.children();return o.append(a),o.append(i.hide()),i.append(s),a.append(n),a.append(r.makeA(r.login_url,r.locale.login_page)),!0},r.prototype.validate=function(){var r=this,e=r.getSerializedFormData(),o={};return t.each(e,function(e,n){var a=n.name,i=t.trim(n.value||"");return a!==r.buildFormInputName("login")||i?a!==r.buildFormInputName("captcha")||i?a!==r.buildFormInputName("confirmation_code")||i?void 0:void(o.confirmation_code=[r.locale.confirmation_code_required||r.locale.required||""]):void(o.captcha=[r.locale.captcha_required||r.locale.required||""]):void(o.login=[r.locale.login_required||r.locale.required||""])}),o},r}(jQuery),WaFrontendForgotPassword=function(t){var r=function(t){this.init(t)},e=r;e.className="WaFrontendForgotPassword";var o=WaLoginAbstractForgotPasswordForm;return WaLoginAbstractForm.inherit(e,o),e.prototype.initVars=function(t){var r=this;r.className=e.className,r.classes={field:"wa-field"},o.prototype.initVars.call(r,t),r.env="frontend"},e.prototype.init=function(r){var e=this;o.prototype.init.call(e,r);var n=function(){e.turnOffBlock(e.getFormField("confirmation_code")),e.$wrapper.find("."+e.classes.message_msg).hide(),e.getFormInput("login").removeAttr("readonly"),e.turnOnBlock(e.$wrapper.find(".wa-forgotpassword-button")),e.$wrapper.find(".wa-edit-login-link-wrapper").hide(),e.$wrapper.find(".wa-send-again-confirmation-code-link-wrapper").hide()};n(),e.$wrapper.find(".wa-edit-login-link-wrapper").click(function(){n()}),e.$wrapper.find(".wa-confirmation-code-input-submit").click(function(r){r.preventDefault(),e.submit({$button:t(this),$loading:e.$wrapper.find(".wa-confirmation-code-input-submit-loading")})});var a=e.$wrapper.find(".wa-send-again-confirmation-code-link");a.click(function(t){t.preventDefault(),e.getFormInput("confirmation_code").attr("disabled",!0),e.submit({$button:a,$loading:e.$wrapper.find(".wa-send-again-confirmation-code-link-loading")}),e.getFormInput("confirmation_code").attr("disabled",!1)})},e.prototype.onDoneSubmitHandlers=function(){var t=this,r=o.prototype.onDoneSubmitHandlers.call(t),e=function(r){t.$wrapper.find("."+t.classes.message_msg).html(""),t.showInfoMessages({sent:r.data.sent_message})},n=function(r){t.turnOnBlock(t.getFormField("confirmation_code")),t.getFormInput("confirmation_code").val(""),t.turnOffBlock(t.$wrapper.find(".wa-forgotpassword-button")),e(r);var o=t.formatInfoMessage(r.data.timeout_message,!1);t.$wrapper.find(".wa-confirmation-code-input-message").html(o),t.getFormInput("login").attr("readonly",1);var n=t.$wrapper.find(".wa-edit-login-link-wrapper").hide(),a=t.$wrapper.find(".wa-send-again-confirmation-code-link-wrapper").hide();t.runTimeoutMessage(o,{timeout:r.data.timeout,onFinish:function(){n.show(),a.show()}})},a=function(r){e(r),t.turnOffBlock(t.getFormField("login")),t.turnOffBlock(t.$wrapper.find(".js-forgotpassword-form-actions"))};return r.rest=function(r){r.data.code_confirmed?t.triggerEvent("wa_auth_set_password",[r.data.hash||""]):"sms"===r.data.channel_type?n(r):"email"===r.data.channel_type&&a(r)},r},e}(jQuery);
//# sourceMappingURL=forgotpassword-frontend-form.min.js.map
